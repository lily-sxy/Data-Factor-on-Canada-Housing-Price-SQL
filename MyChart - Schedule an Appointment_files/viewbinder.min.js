/*! Copyright (c) Epic Systems Corporation 2016-2018 */
var debug_clickedModel;$$WP.$body=$$WP.$body||$afe.select("body");(function WP$Common$ViewBinder$definition(){var f="[data-model-id]",c='"]',e='[data-view-binder-id="',d="data-view-binder-id",b="data-model-id",a=null,h=$$WP.Common.Model,k=$$WP.Common.ModelCollection,g=function WP$Common$ViewBinder(e,c){var b=this,d;b.WP$Controllers$Controller();e=e||[];c=c||[];b.proxify("_onDomEventWrapper","_onPropertyChangedWrapper");b.ViewBinderId=j++;b._eventNames=e.join(" ");b._boundModels={};b._modelId2listenerId={};b._propertyNames={};for(d=0;d<c.length;d++)b._propertyNames[c[d]]=true;if($$WP.$body!==a&&$$WP.$body.length===0)$$WP.$body=$afe.select("body");b.setBindingRoot($$WP.$body)},l={ViewBinderId:a,_eventNames:a,_propertyNames:a,_$bindingRoot:a,_boundModels:a,_modelId2listenerId:a,bindModel:function(b){var a=this,c;if(!a._boundModels[b.ModelId]){a._boundModels[b.ModelId]=true;c=b.addPropertyListener("",a._onPropertyChangedWrapper);a._modelId2listenerId[b.ModelId]=c}},bindAllModels:function(b){for(var a=0;a<b.length;a++)this.bindModel(b[a])},bind:function(c,a){this.bindModel(c);a.safeAttr(b,c.ModelId);a.safeAttr(d,this.ViewBinderId)},unbindModel:function(b){var a=this;if(a._boundModels[b.ModelId]){delete a._boundModels[b.ModelId];b.removePropertyListener(a._modelId2listenerId[b.ModelId]);a.unbindElement(a.getBoundElements(b,a._$bindingRoot))}},unbindElement:function(a){a.removeAttr(b);a.removeAttr(d)},getBoundElements:function(d,b){var a;b=b||this._$bindingRoot;a=e+this.ViewBinderId+c;if(typeof d!=="undefined")a+='[data-model-id="'+d.ModelId+c;return b.find(a)},getBoundModels:function(){var c,d,a;d={};c=this.getBoundElements();for(a=0;a<c.length;a++)d[$afe.jq(c.get(a)).safeAttr(b)]=true;return k.modelIdSet2Array(d)},setBindingRoot:function(f){var b=this,d;d=e+b.ViewBinderId+c;b._$bindingRoot!==a&&b._$bindingRoot.off(b._eventNames,d,b._onDomEventWrapper);b._$bindingRoot=f;b._$bindingRoot.on(b._eventNames,d,b._onDomEventWrapper)},syncModelsToDOM:function(){var a,b;b=this.getBoundModels();for(a=0;a<b.length;a++)this._onSyncModelToDOM(b[a])},_onDomEventWrapper:function(g,i){var d,f,e;d=$afe.jq(g.target).closest('[data-model-id][data-view-binder-id="'+this.ViewBinderId+c);e=d.safeAttr(b);f=h.getInstance(e);(f!==a||e==="-1")&&this._onDomEvent(f,d,g,i)},_onPropertyChangedWrapper:function(a){this._propertyNames[a.propertyName]&&this._onPropertyChanged(a.model,a)},_onPropertyChanged:function(){throw"[ViewBinder] Subclass did not implement the virtual method _onPropertyChanged";},_onSyncModelToDOM:function(){throw"[ViewBinder] Subclass did not implement the virtual method _onSyncModelToDOM";},_onDomEvent:function(){throw"[ViewBinder] Subclass did not implement the virtual method _onDomEvent";}},j=0,i=function WP$Common$ViewBinder$s_getBoundModelOnClick(g){var d,e,c;if(!g.ctrlKey||!$$WP.Debug.IsEnabled)return;d=$afe.jq(g.target).closest(f);e=d.safeAttr(b);c=h.getInstance(e);if(c!==a){debug_clickedModel=c;$$WP.Debug.log("(Ctrl+Click on bound model) Global variable debug_clickedModel set to point at model #"+c.ModelId+" : "+c._constructor._className)}};g.prototype=l;$$WP.Common=$$WP.Common||{};$$WP.Common.ViewBinder=g;g.extend($$WP.Controllers.Controller,"WP$Common$ViewBinder");if($$WP.Debug.IsEnabled)$$WP.$body.on("click",f,i)})();$$WP.Debug.UnitTest=$$WP.Debug.UnitTest||{};$$WP.Debug.UnitTest.tests=$$WP.Debug.UnitTest.tests||[];$$WP.Debug.UnitTest.tests.push(function UnitTests$Common$ViewBinder(){var a;a=$$WP.Debug.UnitTest.assert})