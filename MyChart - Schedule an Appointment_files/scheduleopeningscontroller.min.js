Epic.PatientAccess.Controllers.ScheduleOpeningsController=function Epic$PatientAccess$Controllers$ScheduleOpeningsController(i,h){var g='input[name="fromDate"]',c=null,a=this;a.Controllers$Controller(i);a.proxify("__setUpCalendar","__onCalendarDatePicked","__onDateInputChanged","__onDateInputKeydown");var b,e,f,d;b=a;a._scheduleDays={Index:[],AllDays:{},NumDays:0,AllProviders:{},NumProviders:0,AllDepartments:{},NumDepartments:0};a._providerInfo={};a._sortOrder=c;a._template=c;a._currentDateIndex="";a._IsLoading=false;a.__isIncrementalLoadingDisabled=false;a._lockTimeoutId="";a._providerId="";a._selectedProviderId="";a._Filters={Providers:{},Departments:{},DaysOfWeek:{},TimesOfDay:a.TimeOfDayEnum.Both};a._PreviousFilters={Providers:{},Departments:{},DaysOfWeek:{},TimesOfDay:a.TimeOfDayEnum.Both};a._visibleDepartments=[];a._handlebarsTemplate=$$WPUtil.GetStringResource(a._GUID,"_template");a._settings={_openingsUrl:$$WPUtil.GetStringResource(a._GUID,"openingsUrl"),_scheduleUrl:$$WPUtil.GetStringResource(a._GUID,"scheduleUrl"),_errorUrl:$$WPUtil.GetStringResource(a._GUID,"errorUrl"),_locationSearchUrl:$$WPUtil.GetStringResource(a._GUID,"locationSearchUrl"),_openingsUrlParams:{},_defaultSortOrder:a.SortOrderEnum.ByDateThenProviderCollated,_DefaultThumbnailUrl:$$WPUtil.GetStringResource(a._GUID,"defaultPhotoUrl"),_DefaultInfoUrl:"#",_detailsContainer:c,_showDetailsCallback:c,_hideDetailsCallback:c,_showAuthPaneFunction:c,_scheduleSuccessFunction:c,__schedulingMinSearchOffset:parseInt($$WPUtil.GetStringResource(a._GUID,"SchedulingMinSearchOffset"),10)||c,__schedulingMaxSearchOffset:parseInt($$WPUtil.GetStringResource(a._GUID,"SchedulingMaxSearchOffset"),10)||c,__openSchedMinSearchOffset:parseInt($$WPUtil.GetStringResource(a._GUID,"OpenSchedMinSearchOffset"),10),__openSchedMaxSearchOffset:parseInt($$WPUtil.GetStringResource(a._GUID,"OpenSchedMaxSearchOffset"),10),__showAppointmentComment:parseInt($$WPUtil.GetStringResource(a._GUID,"ShowAppointmentComment"),10),__showAppointmentCommentEnum:{Hide:0,ShowOptional:1,ShowRequired:2},__showAppointmentCommentVTEnum:{NotSet:-1,AskComment:0,AskAndRequireComment:1,DoNotAskComments:2}};a._AppointmentDetailsController=new $$WP.Controllers.AppointmentDetailsController(a._ViewInstance);f=b.ReadSettingsFromConfig();f&&$.extend(b._settings,f);h&&$.extend(b._settings,h);b._settings._providerId&&a.SetDataUrlParam("id",b._settings._providerId);b._settings._visitTypeId&&a.SetDataUrlParam("vt",b._settings._visitTypeId);b._settings._departmentId&&a.SetDataUrlParam("dept",b._settings._departmentId);b._settings._accessCode&&a.SetDataUrlParam("accessCode",b._settings._accessCode);b._modifiedButtonsArray=[];a._RegisterHandlebarsHelpers();b._handlebarsTemplate&&a.SetDataUrlParam("view",b._handlebarsTemplate);if(!$$WPUtil.IsNullOrEmpty(a._settings._errorCode))if(a._settings._errorCode===a.ResponseErrorCodeEnum.InvalidAccessCode||a._settings._errorCode===a.ResponseErrorCodeEnum.ExpiredAccessCode){a.__showAccessCodeError("InvalidAccessCodeError");return}else if(a._settings._errorCode===a.ResponseErrorCodeEnum.ExpiredAccessCodeAndRequeued){a.__showAccessCodeError("ExpiredAccessCodeError");return}e=$$WPUtil.GetUniqueJQueryById(b._GUID,"OpeningsData");e.on("doneloading",function(){var a="lastInDay",c;c=b._findScrollingElement();if(e.parents(".slider").css("overflow-y")==="scroll"||b._isPostLoginWidget())b._isScrolledToBottom(e.parents(".slider"))&&!b._DateLimitIsReached&&b.ShowNextDays();else(b._isScrolledToBottom(c.get(0))||!$$WPUtil.ElementHasYOverflow(c.get(0)))&&!b._DateLimitIsReached&&b.ShowNextDays();$afe.select(".slotslist").each(function(){var a=this,b=true;if($$WPUtil.isBrowserCapableOf("touchEvents"))if(self===top)$afe.jq(a).addClass("ontouchdevice");else{$afe.jq(a).addClass("onslowtouchdevice");b=false}b&&WP.Controls.ScrollIndicator.addTo(a,.75*a.clientWidth)});$afe.select(".primarylabel").prev(".providercard").addClass(a);$afe.select(".providercard:last-child").addClass(a)});if(navigator.userAgent.match(/Trident\/7./))e.on("mousewheel",function(a){!$afe.jq(this).hasClass("openingsNoData")&&a.stopPropagation()});d=$$WPUtil.GetStringResource(a._GUID,"numberOfDepartmentsOnFirstLoad");if(d)a._numberOfDepartmentsOnFirstLoad=parseInt(d,10);d=$$WPUtil.GetStringResource(a._GUID,"distanceToAlwaysIncludeDepartments");if(d)a._distanceToAlwaysIncludeDepartments=parseInt(d,10);d=$$WPUtil.GetStringResource(a._GUID,"distanceToNeverIncludeDepartments");if(d)a._distanceToNeverIncludeDepartments=parseInt(d,10);a.$root=$afe.select("body");a.$root.on("keydown",g,a.__onDateInputKeydown);a.$root.on("change",g,a.__onDateInputChanged)};Epic.PatientAccess.Controllers.ScheduleOpeningsController.prototype={DataValidationFunction:null,_settings:null,_scheduleDays:null,_sortOrder:null,_template:null,_handlebarsTemplate:null,_currentDateIndex:null,_IsLoading:null,__isIncrementalLoadingDisabled:false,_DateLimitIsReached:false,_lockTimeoutId:null,_Filters:null,_visibleDepartments:null,_PreviousFilters:null,_AreFiltersPopulated:false,_modifiedButtonsArray:null,_GUID:"D6F73C26-7627-4948-95EA-2C630C25C5E9_scheduleOpenings",_selectedProviderId:"",_providerInfo:null,_AppointmentDetailsController:null,_showAuthPaneFunction:null,_errorUrl:null,_slotsPerRow:0,_onDeselectSlotHandler:null,_sessionToken:null,_captchaObj:null,_captchaToken:null,_selectedSlotEle:null,_geolocationLatitude:null,_geolocationLongitude:null,_searchLatitude:null,_searchLongitude:null,_numberOfDepartmentsOnFirstLoad:null,_distanceToAlwaysIncludeDepartments:null,_distanceToNeverIncludeDepartments:null,_hasVisibleDepartments:true,__firstDteToShow:0,__minDte:0,__maxDte:0,__isNewDateSelected:false,__filtersViewModel:null,__minFromDaysOffset:null,__maxToDaysOffset:null,__baseSlotsPerRow:5,_loadIncrement:6,_defaultTemplate:"ByDateThenProviderCollated",_lockTimeoutPeriod:3e3,_scrollTransitionSpeed:600,_showTransitionSpeed:600,_hideTransitionSpeed:600,SortOrderEnum:{ByDateThenProviderCollated:"ByDateThenProviderCollated"},DayOfWeekEnum:{Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},TimeOfDayEnum:{Both:"both",AM:"am",PM:"pm"},ResponseErrorCodeEnum:{None:"",StartDateTooFarInFuture:"StartDateTooFarInFuture",ConnectionThrottled:"ConnectionThrottled",InvalidAccessCode:"InvalidAccessCode",ExpiredAccessCode:"ExpiredAccessCode",ExpiredAccessCodeAndRequeued:"ExpiredAccessCodeAndRequeued"},__initializeDateAndFormValidation:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__initializeDateAndFormValidation(c){var a=this,b=null;a.__initializeDateRange(c);if(a._scheduleDays.Index.length>0)b=new Date(a._scheduleDays.Index[0]);else b=new Date;a.__firstDteToShow=a.__getValidSlotDte(WP.Utils.date2dte(b));a.__filtersViewModel={DateRangeValidationSettings:new $$WP.FormValidation.ValidationSettings({required:false,isDate:true,minDate:WP.Utils.dte2date(a.__minDte),maxDate:WP.Utils.dte2date(a.__maxDte)}),FromDate:a.__formatDteAsDate(a.__firstDteToShow)}},__setUpCalendar:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__setUpCalendar(c){var a=this,b=a._GUID+"_dateRangeContainer_fromDate";writeCalendar(b,"range",c,a.__minDte,a.__maxDte,a.__onCalendarDatePicked);$$WP.FormValidation.initializeDOMSubtree(a.$root)},__changeSlotDateRange:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__changeSlotDateRange(c){var a=this,b=a.__getValidSlotDte(c);if(a.__firstDteToShow===b)return;a.HideSlotDetails(a);a.__firstDteToShow=b;a.__isNewDateSelected=true;a.LoadMoreScheduleDays()},__onDateInputKeydown:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__onDateInputKeydown(a){var c=13,b=a.which;if(b===c){a.preventDefault();WP.Events.fireEvent(a.target,"change")}},__onCalendarDatePicked:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__onCalendarDatePicked(e,d,f,b){var c=0,a=0;if(!b)return;c=new Date(e,d,f);a=WP.Utils.date2dte(c);b.value=this.__formatDteAsDate(a);this.__changeSlotDateRange(a)},__onDateInputChanged:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__onDateInputChanged(d){var a=null,b=false,c=true;a=parseDate(d.target.value,c);if(!$$WPUtil.IsNullOrEmpty(a)){b=$$WP.FormValidation.checkIfFormIsValid(this.$root.find('form[name="dateRangeContainer"]'),false);b&&this.__changeSlotDateRange(WP.Utils.date2dte(a))}},__getValidSlotDte:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__getValidSlotDte(b){var a=b;a=Math.max(a,this.__minDte);a=Math.min(a,this.__maxDte);return a},__formatDteAsDate:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__formatDteAsDate(c){var b=null,a="";if(!$$WPUtil.IsNullOrEmpty(c)){b=new $$WP.I18N.Date(formatDate(WP.Utils.dte2date(c)),"string");a=$$WP.I18N.formatPatientGivenDate(b.DateObject)}return a},_isPostLoginWidget:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_isPostLoginWidget(){return this._settings._isPostLogin&&this._settings._isProviderContext},ReadSettingsFromConfig:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ReadSettingsFromConfig(){var b={},a;a=$$WPUtil.GetStringResource(this._GUID,"providerId");if(a)b._providerId=a;a=$$WPUtil.GetStringResource(this._GUID,"_openingsUrl");if(a)b._openingsUrl=a;a=$$WPUtil.GetStringResource(this._GUID,"_scheduleUrl");if(a)b._scheduleUrl=a;return b},TriggerScrollCheck:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$TriggerScrollCheck(){$$WPUtil.GetUniqueJQueryById(this._GUID,"OpeningsData").trigger("scrollcheck")},ShowNextDays:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ShowNextDays(b){var a=this;$$WPUtil.GetUniqueJQueryById(a._GUID,"OpeningsContainer").removeClass("hidden");b&&a.ClearResultsTable();if(a._currentDateIndex===""||a._currentDateIndex===a._scheduleDays.Index.length-1)a.LoadMoreScheduleDays();else{a._currentDateIndex=a._currentDateIndex+1;a.PopulateResultsTable()}},ExecuteDeselectSlotHandler:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ExecuteDeselectSlotHandler(b){var a=this;if(!!a._onDeselectSlotHandler){a._onDeselectSlotHandler(b);WP.Events.removeListener(window,"beforeunload",a._onDeselectSlotHandler);a._onDeselectSlotHandler=null}else!!b&&b()},GetCurrentDays:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$GetCurrentDays(){var a=this,b;if(a._currentDateIndex==="")return null;b=a._scheduleDays[a._scheduleDays.Index[a._currentDateIndex]];return b},GetNextStartDate:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$GetNextStartDate(){var b=this,a;if(b._scheduleDays.Index.length===0)return"";a=b._scheduleDays.Index;return b._scheduleDays[a[a.length-1]].LatestDate},ClearScheduleDays:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ClearScheduleDays(){var a=this;a._scheduleDays={Index:[],AllDays:{},NumDays:0,AllProviders:{},NumProviders:0,AllDepartments:{},NumDepartments:0};a._currentDateIndex="";a._DateLimitIsReached=false;a._hasVisibleDepartments=true;a.__isIncrementalLoadingDisabled=false},ClearResultsTable:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ClearResultsTable(){$$WPUtil.GetUniqueJQueryById(this._GUID,"OpeningsData").empty();this.ClearDetailsPane()},ClearDetailsPane:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ClearDetailsPane(){$$WPUtil.GetUniqueJQueryById(this._GUID,"slotDetails").empty()},ResetSlots:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ResetSlots(){var a=this;$$WPUtil.GetUniqueJQueryById(a._GUID,"OpeningsData").off("scrollcheck");a.ClearResultsTable();a.ClearScheduleDays();a.HideSlotDetails(a)},ResetWidget:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ResetWidget(){var a=this;a.ResetSlots();a.ClearAllFilters();a._AreFiltersPopulated=false;a._ClearLoadingLock();a.__isIncrementalLoadingDisabled=false},HideControls:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$HideControls(){$$WPUtil.GetUniqueJQueryById(this._GUID,"OpeningsControls").addClass("hidden")},ShowControls:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ShowControls(){$$WPUtil.GetUniqueJQueryById(this._GUID,"OpeningsControls").removeClass("hidden")},MarkButtonAsModified:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$MarkButtonAsModified(a){this._modifiedButtonsArray.push(a)},ResetModifiedButtons:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ResetModifiedButtons(){var c="dismissed",a=this._modifiedButtonsArray.pop(),b;while(a!==null&&typeof a!=="undefined"){b=$afe.jq(a);b.removeClass("selected").addClass(c);b.parent().find(".firstslot").removeClass(c);a=this._modifiedButtonsArray.pop()}},SetDataUrlParam:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$SetDataUrlParam(c,b){var a=this;a._settings._openingsUrlParams[c]=b},_SetLoadingLock:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_SetLoadLock(){var a=this;if(a._lockTimeoutId){window.clearTimeout(a._lockTimeoutId);a._lockTimeoutId=""}a._IsLoading=true;a._lockTimeoutId=window.setTimeout($.proxy(function(){this._IsLoading=false;this._lockTimeoutId="";this._checkForNoData()},a),a._lockTimeoutPeriod)},_ClearLoadingLock:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_ClearLoadingLock(){var a=this;if(a._lockTimeoutId){window.clearTimeout(a._lockTimeoutId);a._lockTimeoutId=""}a._IsLoading=false;a._checkForNoData()},_IsLoadingLocked:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_IsLoadingLocked(){return this._IsLoading||this.__isIncrementalLoadingDisabled},_checkForNoData:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_checkForNoData(){var h="disabled",g="onlyone",c=false,i="openingsNoData",e=true,a=this,f,b,d=$$WPUtil.GetUniqueJQueryById(a._GUID,"OpeningsData");if(a._DateLimitIsReached===e)if(a.__hasAvailableSlots())d.children().last().addClass("finalrow");else{$$WPUtil.PopulateComplexTemplate(a._GUID,"OpeningsNoData",d);d.addClass(i);f=a._GUID+"_filterControls_0_";if(Object.keys(a._Filters.Departments).length===a._scheduleDays.NumDepartments){b=$afe.select("#"+f+"locations");b.click(function(){return c});b.addClass(g).prop(h,e)}if(Object.keys(a._Filters.Providers).length===a._scheduleDays.NumProviders){b=$afe.select("#"+f+"people");b.click(function(){return c});b.addClass(g).prop(h,e)}if(Object.keys(a._Filters.DaysOfWeek).length===Object.keys(a.DayOfWeekEnum).length&&a._Filters.TimesOfDay===a.TimeOfDayEnum.Both){b=$afe.select("#"+f+"datetime");b.click(function(){return c});b.addClass(g).prop(h,e)}}else if(!a._hasVisibleDepartments){$$WPUtil.PopulateComplexTemplate(a._GUID,"OpeningsAllFiltered",d);d.addClass(i);$$WPUtil.GetUniqueJQueryById(a._GUID,"OpeningsControls").show();$$WPUtil.GetUniqueJQueryById(a._GUID,"OpeningsAllFiltered_0_showall").on("click",function(b){var a="#locationGroup";b.preventDefault();$afe.select(a).find("a.selectAll").click();$afe.select(a).find("a.applyFilter").click();return c})}},SetGeolocationCoordinates:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$SetGeolocationCoordinates(b,a){this._geolocationLatitude=b;this._geolocationLongitude=a},HasGeolocationCoordinates:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$HasGeolocationCoordinates(){return this._geolocationLatitude!==null&&this._geolocationLongitude!==null?true:false},SetLocationFilterSearch:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$SetLocationFilterSearch(d,c,b){var a=this;if(b){a._searchLatitude=a._geolocationLatitude;a._searchLongitude=a._geolocationLongitude}else{a._searchLatitude=d;a._searchLongitude=c}},GetLocationSearchCoordinates:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$GetLocationSearchCoordinates(b,a){var c=this;$.get(this._settings._locationSearchUrl,{searchString:b},function(b){b&&b.Success&&c.SetLocationFilterSearch(b.Latitude,b.Longitude);typeof a==="function"&&a(b.Success)})},LoadMoreScheduleDays:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$LoadMoreScheduleDays(){var d="OpeningsData",b=null,a=this,e,g=b,f=a._settings._openingsUrlParams,c=false;if(a._IsLoadingLocked())return;if(!a._hasVisibleDepartments)return;if(!f.vtList&&!f.vt)return;$$WPUtil.GetUniqueJQueryById(a._GUID,d).removeClass("openingsNoData");if(a.__firstDteToShow!==0&&a.__firstDteToShow!==undefined&&a.__isNewDateSelected){e=WP.Utils.dte2date(a.__firstDteToShow).toISOString();a.ClearScheduleDays();g=a._findScrollingElement();g.scrollTop(0)}else e=a.GetNextStartDate();a.SetDataUrlParam("start",e);a.SetDataUrlParam("filters",JSON.stringify(a._Filters));a._SetLoadingLock();$.ajax({url:a._settings._openingsUrl,type:"POST",data:f,context:a}).done(function(n){var g=true,a=this,h,e,f,m;e=JSON.parse(n);if(e.ErrorCode===a.ResponseErrorCodeEnum.StartDateTooFarInFuture){a._DateLimitIsReached=g;a._checkForNoData();return}else if(e.ErrorCode===a.ResponseErrorCodeEnum.ConnectionThrottled){a.__showHighDemandError();return}if(typeof a.DataValidationFunction==="function"&&!a.DataValidationFunction(e))return;h=e.EarliestDate;if(h){e.arrayIndex=a._scheduleDays.Index.length;a._scheduleDays[h]=e;a._scheduleDays.Index.push(h);for(f in e.AllDays){if(!e.AllDays.hasOwnProperty(f))continue;a._scheduleDays.AllDays[f]=e.AllDays[f];a._scheduleDays.NumDays=a._scheduleDays.NumDays+1}e.AllDays={};for(f in e.AllProviders)if($$WPUtil.IsNullOrEmpty(a._scheduleDays.AllProviders[f])){m=e.AllProviders[f];a._scheduleDays.AllProviders[f]=m;a._scheduleDays.NumProviders=a._scheduleDays.NumProviders+1;c=g}e.AllProviders={};var l=$$WPUtil.IsNullOrEmpty(a._searchLatitude)||$$WPUtil.IsNullOrEmpty(a._searchLongitude),j=!($$WPUtil.IsNullOrEmpty(a._geolocationLatitude)||$$WPUtil.IsNullOrEmpty(a._geolocationLongitude));l&&j&&a.SetLocationFilterSearch(b,b,g);for(f in e.AllDepartments)if($$WPUtil.IsNullOrEmpty(a._scheduleDays.AllDepartments[f])){a._scheduleDays.AllDepartments[f]=e.AllDepartments[f];a._scheduleDays.AllDepartments[f].Distance=a._DistanceFromSearch(a._scheduleDays.AllDepartments[f]);a._scheduleDays.NumDepartments=a._scheduleDays.NumDepartments+1;c=g}l&&j&&a.SetLocationFilterSearch(b,b);e.AllDepartments={};a._currentDateIndex=a._scheduleDays.Index.length-1}var k=e.VisitTypeInfo&&e.VisitTypeInfo.IsAdvanced&&e.VisitTypeInfo.GroupByDepartment,i=e.VisitTypeInfo;if(a._AreFiltersPopulated===false&&c){a.PopulateFilteringTemplate(k,i);a._AreFiltersPopulated=g}!$$WPUtil.IsNullOrEmpty(i)&&a._UpdateAppointmentComments(i.ShowAppointmentCommentVT);a.PopulateResultsTable(k);a._ClearLoadingLock();$$WPUtil.GetUniqueJQueryById(a._GUID,d).trigger("doneloading")})},__showHighDemandError:function Epic$PatientAccess$Controller$ScheduleOpeningsController$__showHighDemandError(){var d="HighDemandCloseButtonCaption",a=this,c=null,b={};if(a.__hasAvailableSlots()){a.__isIncrementalLoadingDisabled=true;c=new $$WPComp.ConfirmComponent({IsClosable:false,forcePrompt:true,Html:a.__buildHighDemandAlertHtml("HighDemandSubsequentLoadDescription","HighDemandSubsequentLoadInstructions"),callback:function(){},ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WPUtil.GetStringResource(a._GUID,d))]})}else c=new $$WPComp.ConfirmComponent({IsClosable:false,forcePrompt:true,Html:a.__buildHighDemandAlertHtml("HighDemandFirstLoadDescription","HighDemandFirstLoadInstructions"),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WPUtil.GetStringResource(a._GUID,"HighDemandRetryButtonCaption")),new $$WPComp.ComplexObjects.Button($$WPUtil.GetStringResource(a._GUID,d))],AffirmButtonIndex:0,callback:$.proxy(function(a){if(a){this._ClearLoadingLock();this.LoadMoreScheduleDays()}},a)});b.Size=$$WPContain.Popup.SizeEnum.SMALL;if(a.__isInsideShortWindow())b.positioningFunction=$$WPContain.Positions.InsideNearTop;else b.positioningFunction=$$WPContain.Positions.InsideCentered;$$WPUtil.quickPopup(c,b)},__showAccessCodeError:function Epic$PatientAccess$Controller$ScheduleOpeningsController$__showAccessCodeError(c){var b=null,a={};b=new $$WPComp.ConfirmComponent({IsClosable:false,forcePrompt:true,Html:this.__buildHighDemandAlertHtml(c),callback:function(){}});a.Size=$$WPContain.Popup.SizeEnum.SMALL;if(this.__isInsideShortWindow())a.positioningFunction=$$WPContain.Positions.InsideNearTop;else a.positioningFunction=$$WPContain.Positions.InsideCentered;$$WPUtil.quickPopup(b,a);return},__isInsideShortWindow:function Epic$PatientAccess$Controller$ScheduleOpeningsController$__isInsideShortWindow(){return window.innerHeight<=400},__buildHighDemandAlertHtml:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__buildHighDemandAlertHtml(c,b){var a=0;if(this.__isInsideShortWindow())a=110;else a=160;return"<div style='text-align: center;'><img width='"+a+"' height='"+a+"' src='"+makeStaticLink("images/highdemand.svg")+"' aria-hidden='true'></img><p>"+$$WPUtil.GetStringResource(this._GUID,c)+"</p><p>"+$$WPUtil.GetStringResource(this._GUID,b)+"</p></div>"},__hasAvailableSlots:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__hasAvailableSlots(){var a=this,b="",d="",e=0,c=0;if(!a._scheduleDays.Index||a._scheduleDays.length===0)return false;e=a._scheduleDays.Index.length;for(c=0;c<e;c++){b=a._scheduleDays.Index[c];if(!a._scheduleDays[b])continue;for(d in a._scheduleDays[b].AllDays)if(a._scheduleDays[b].AllDays.hasOwnProperty(d))return true;if(a.__hasAvailableSlotsByDateThenProvider(b))return true}return false},__hasAvailableSlotsByDateThenProvider:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__hasAvailableSlotsByDateThenProvider(h){var d=null,c=null,e=null,g=0,f=0,i="",j="",b=0,a=0;for(i in this._scheduleDays[h].ByDateThenProviderCollated){d=this._scheduleDays[h].ByDateThenProviderCollated[i].ProvidersAndHours;g=d.length;for(b=0;b<g;b++){c=d[b].DepartmentAndSlots;f=c.length;for(a=0;a<f;a++){e=c[a].HoursAndSlots;for(j in e)if(e[j].Slots.length>0)return true}}}return false},PopulateResultsTable:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$PopulateResultsTable(J){var G=".hoverPopupLink",F=".infoLink",n=".provinfocontainer",e="hidden",k=".hiddenslots",E=".moreslotslabel",s="click",r=".moreslots",q=".slotdetailaction",p=".slider",j="scrollcheck",x="scroll",i=true,h=false,f=this,a=f,I,H,m,c,y,b,B,A,w,o;template=a._template||a._defaultTemplate;I=a._sortOrder||a._settings._defaultSortOrder;c=a.GetCurrentDays();y=I!==f.SortOrderEnum.ByDateThenProviderCollated;if(y||a.__isNewDateSelected){a.ClearResultsTable();a.__isNewDateSelected=h}var D=h,t;for(t in f._scheduleDays.AllDepartments){if(!f._scheduleDays.AllDepartments.hasOwnProperty(t))continue;D=i;break}if(D){f._hasVisibleDepartments=h;for(t in f._visibleDepartments){if(!f._visibleDepartments.hasOwnProperty(t))continue;f._hasVisibleDepartments=i;break}if(!f._hasVisibleDepartments){$$WPUtil.GetUniqueJQueryById(f._GUID,"filterControls_0_locationsLoadMore").find("a").click();f._checkForNoData();return}}var v=h,u=h,d,g,l;for(d in c.ByDateThenProviderCollated){if(!c.ByDateThenProviderCollated.hasOwnProperty(d))continue;v=h;for(g in c.ByDateThenProviderCollated[d].ProvidersAndHours){if(!c.ByDateThenProviderCollated[d].ProvidersAndHours.hasOwnProperty(g))continue;u=h;for(l in c.ByDateThenProviderCollated[d].ProvidersAndHours[g].DepartmentAndSlots){if(!c.ByDateThenProviderCollated[d].ProvidersAndHours[g].DepartmentAndSlots.hasOwnProperty(l))continue;if(!a._Filters.Departments[l])delete c.ByDateThenProviderCollated[d].ProvidersAndHours[g].DepartmentAndSlots[l];else u=i}if(!u)delete c.ByDateThenProviderCollated[d].ProvidersAndHours[g];else v=i}if(!v)delete c.ByDateThenProviderCollated[d]}function departmentSortFunction(b,c){b=a._scheduleDays.AllDepartments[b.DepartmentID];c=a._scheduleDays.AllDepartments[c.DepartmentID];return $$WPUtil.IsNullOrEmpty(c.Distance)?$$WPUtil.IsNullOrEmpty(b.Distance)?b.Name.localeCompare(c.Name):-1:$$WPUtil.IsNullOrEmpty(b.Distance)?1:b.Distance===c.Distance?b.Name.localeCompare(c.Name):b.Distance-c.Distance}function providerSortFunction(b,c){var d,e;if(J){d=a._scheduleDays.AllDepartments[b.ProviderID].Name;e=a._scheduleDays.AllDepartments[c.ProviderID].Name}else{d=a._scheduleDays.AllProviders[b.ProviderID].DisplayName;e=a._scheduleDays.AllProviders[c.ProviderID].DisplayName}b=a._scheduleDays.AllDepartments[b.DepartmentAndSlots[0].DepartmentID];c=a._scheduleDays.AllDepartments[c.DepartmentAndSlots[0].DepartmentID];return $$WPUtil.IsNullOrEmpty(c.Distance)?$$WPUtil.IsNullOrEmpty(b.Distance)?d.localeCompare(e):-1:$$WPUtil.IsNullOrEmpty(b.Distance)?1:b.Distance===c.Distance?d.localeCompare(e):b.Distance-c.Distance}if(c!==null){for(d in c.ByDateThenProviderCollated){if(!c.ByDateThenProviderCollated.hasOwnProperty(d))continue;var C=[];for(g in c.ByDateThenProviderCollated[d].ProvidersAndHours){if(!c.ByDateThenProviderCollated[d].ProvidersAndHours.hasOwnProperty(g))continue;var z=[];for(l in c.ByDateThenProviderCollated[d].ProvidersAndHours[g].DepartmentAndSlots){if(!c.ByDateThenProviderCollated[d].ProvidersAndHours[g].DepartmentAndSlots.hasOwnProperty(l))continue;z.push(c.ByDateThenProviderCollated[d].ProvidersAndHours[g].DepartmentAndSlots[l])}z.sort(departmentSortFunction);c.ByDateThenProviderCollated[d].ProvidersAndHours[g].DepartmentAndSlots=z;C.push(c.ByDateThenProviderCollated[d].ProvidersAndHours[g])}C.sort(providerSortFunction);c.ByDateThenProviderCollated[d].ProvidersAndHours=C}if(a._handlebarsTemplate==="plain")m=$afe.renderTemplate($$WP.Templates.OpenScheduling.OpeningsPlain,c);else if(a._handlebarsTemplate==="grouped")m=$afe.renderTemplate($$WP.Templates.OpenScheduling.OpeningsGrouped,c);else m=$afe.renderTemplate($$WP.Templates.OpenScheduling.OpeningsGrouped,c)}b=$$WPUtil.GetUniqueJQueryById(a._GUID,"OpeningsData");H=b.html().length===0;if(!$$WPUtil.IsNullOrEmpty(m)&&m.html()!==""){m.safeAppendTo(b);f.ShowControls()}else(a._scheduleDays.Index.length===0||y)&&f.HideControls();if(H){$$WPUtil.AddThrottledListener(b,x,"",100,function(){b.trigger(j)});$$WPUtil.AddThrottledListener(b.parents(p),x,"",100,function(){!b.parents(".stepContainer").hasClass("offscreen")&&b.parents(p).trigger(j)});$$WPUtil.AddThrottledListener(window,x,"",100,function(){var c;c=a._findScrollingElement();(c.height()===$afe.select("html").height()||a._isPostLoginWidget())&&b.trigger(j)})}f._checkForNoData();B=function Epic$PatientAccess$Controllers$ScheduleOpeningsController$PopulateResultsTable$showSlotsFn(e){var b="focusin.",c,d;c=$afe.jq(this);d=c.find(q);if(d.length>1){c.addClass("hover");if(e===i){d[1].focus();$afe.select("body").safeAttr("tabindex",-1).on(b+a._GUID,function(d){if(c.has(d.target).length===0){$.proxy(A,c)();$afe.select("body").off(b+a._GUID)}})}}};A=function Epic$PatientAccess$Controllers$ScheduleOpeningsController$PopulateResultsTable$hideSlotsFn(){a.HideOtherSlots($afe.jq(this))};b.off("mouseleave mouseenter",r);b.on({mouseleave:A,mouseenter:B},r);b.off(s,E);b.on({click:function(){$.proxy(B,$afe.jq(this).closest(r))(i)}},E);if(a._handlebarsTemplate)if(a._handlebarsTemplate==="plain"){b.off(s,".expandSlots a");b.on({click:function(){var a=$afe.jq(this);a.parent().prev().find(k).removeClass(e).slideDown(150,function(){a.addClass(e);a.parent().find(".less").removeClass(e);a.parent().prev().children(k).children().first().focus()})}},".expandSlots a.more");b.on({click:function(){var a=$afe.jq(this);a.parent().prev().find(k).slideUp(300,function(){$afe.jq(this).addClass(e);a.addClass(e);a.parent().find(".more").removeClass(e);a.parent().prev().children().first().focus()})}},".expandSlots a.less")}$.each(a._providerInfo,function(c,b){b!=="loading"&&b!==null&&a._PopulateProviderInfo(a,c,b)});w=function Epic$PatientAccess$Controllers$ScheduleOpeningsController$PopulateResultsTable$showProvDtlsFn(b){var a;a=$afe.jq(this).find(n);a.show();a.focus();b.preventDefault()};o=function Epic$PatientAccess$Controllers$ScheduleOpeningsController$PopulateResultsTable$hideProvDtlsFn(){$afe.jq(this).parent().find(n).hide()};b.off("mouseenter click mouseleave blur",F);b.on({mouseenter:w,click:w,mouseleave:o,blur:o},F);b.off("mouseleave",n);b.on({mouseleave:o},n);if(!a._DateLimitIsReached&&a._hasVisibleDepartments){b.on(j,function(c){var b;b=a._findScrollingElement();a._isScrolledToBottom(b.get(0))&&!a._DateLimitIsReached&&a._hasVisibleDepartments&&a.ShowNextDays();c.stopPropagation()});b.parents(p).on(j,function(){var b;b=a._findScrollingElement();a._isScrolledToBottom(this)&&!a._DateLimitIsReached&&a._hasVisibleDepartments&&a.ShowNextDays()})}b.off("click focusin focusout",G);b.on({click:function(a){a.preventDefault();return h},focusin:$$WPUtil.handlePopupInstructions,focusout:$$WPUtil.handlePopupInstructions},G);b.off(s,q);b.on(s,q,$.proxy(function(c){var b=null;b=$afe.jq(c.target);c.preventDefault();c.stopPropagation();if(!a._isReservationEnabled())a._selectSlot(b);else a._selectSlotWithSession(b)},f));f._isPostLoginWidget()&&$$WPUtil.UI.MatchColumnHeights()},_selectSlotWithSession:function(b){var a=this;if(!!a._sessionToken)a._selectSlot(b,a._sessionToken);else{var c=$.proxy(function(c){var a=this;if(a._isRestrictedAccessMode()){a._captchaToken=c;a._selectedSlotEle=b}else a._createPreloginSession(c,$.proxy(function(a){this._selectSlot(b,a.SessionToken)},a),a._settings._accessCode,"",a._settings._sourceToken)},a);if($$WP.Utilities.UI.IsLoggedIn)c();else{if(a._isRestrictedAccessMode())a._selectedSlotEle=b;a._executeCallbackWithCaptchaToken(c)}}},_executeCallbackWithCaptchaToken:function(d){var a=this,c=null,b=null;b=$.proxy(function(a){!this._isRestrictedAccessMode()&&window.setTimeout(resetLightbox,500);d(a)},a);c=a._buildCaptchaContainer();if(!a._isDemoMode()){a._captchaObj=new $$WP.Captcha(c,b);a._captchaObj.Render();a.__addLightboxCloseButton();a.__setLightboxDescribedBy();a.__checkIfiOSAndAddExtraButton()}else a.__drawDemoCaptcha(c,b);!!a._settings._onCaptchaShown&&a._settings._onCaptchaShown()},__addLightboxCloseButton:function(){var c=document.getElementById("lightbox"),a=document.createElement("button"),b=document.querySelector(".visibleCaptchaContainer .visuallabel");if(!c)return;if(!!document.querySelector("#lightbox .closeLightbox"))return;a.className="closeLightbox";a.tabIndex="0";a.setAttribute("aria-label",$$WPUtil.GetStringResource(this._GUID,"closePopupLabel"));a.setAttribute("role","button");a.onclick=resetLightbox;b.parentNode.insertBefore(a,b.nextSibling)},__setLightboxDescribedBy:function(){var a="captchaLightboxLabel",b=document.getElementById("lightbox"),c=document.querySelector("#lightbox .visuallabel");c.id=a;b.setAttribute("aria-labelledby",a)},__checkIfiOSAndAddExtraButton:function(){var c="completeThisPopupLabel",a=null,b=null,d=null;if(!WP.DOM.Browser.isSafari||!WP.DOM.Browser.isMobile)return;d=document.getElementById("lightbox");if(!d)return;if(!!document.querySelector("#lightbox .dummyVoiceOveriOSButton")){a=document.querySelector(".dummyVoiceOveriOSButton");a.focus()}else{a=document.createElement("button");b=document.querySelector(".visibleCaptchaContainer .visuallabel");a.innerHTML=$$WPUtil.GetStringResource(this._GUID,c);a.className="dummyVoiceOveriOSButton";a.tabIndex="0";a.setAttribute("aria-label",$$WPUtil.GetStringResource(this._GUID,c));a.setAttribute("role","button");b.parentNode.insertBefore(a,b);a.focus()}},__drawDemoCaptcha:function(e,f){var d=this,c=null,b=null,a=null;c=document.createElement("div");c.className="visuallabel captchaPretext";c.textContent=$$WPUtil.GetStringResource(d._GUID,"captchaPretext");e.safeAppend(c);b=document.createElement("img");b.src=$$WPUtil.GetStringResource(d._GUID,"captchaDemoUrl");b.className="demoCaptcha";e.safeAppend(b);if(!d._isRestrictedAccessMode()){a=document.createElement("div");a.className="button primary positive demoCaptchaSubmit";a.textContent=$$WPUtil.GetStringResource(d._GUID,"captchaContinueLabel");a.onclick=function(){resetLightbox();f()};e.safeAppend(a)}},_isDemoMode:function(){return $$WPUtil.GetStringResource(this._GUID,"isDemoMode")==="True"},_createPreloginSession:function(d,c,f,b,e){var a=null;a=$.proxy(function(b){var a=this;if(!b.DateOfBirthVerificationFailure){a._sessionToken=b.SessionToken;a._prepopulateRestrictedFields(b);c(b)}else{$$WP.FormValidation.addValidationError($afe.select("#DOBVerify"),"IncorrectDateOfBirth");a._captchaObj.Reset();a._captchaToken=null}},this);$.ajax({url:makeLink("OpenScheduling/OpenScheduling/CreatePreloginSession"),type:"POST",data:{accessCode:f,userEnteredDateOfBirth:b,sourceToken:e},success:a,captchaResponse:d})},_prepopulateRestrictedFields:function(a){var b="change";if(!this._isRestrictedAccessMode())return;var c=$afe.select("#FirstName, #LastName, #DateOfBirthStr");c.prop("readonly",true).prev("label").removeClass("required");$afe.select("#FirstName").val(a.FirstName).trigger(b);$afe.select("#LastName").val(a.LastName).trigger(b);$afe.select("#DateOfBirthStr").val(a.DateOfBirth).trigger(b);if(a.HasLinkedPatient)this._hideOptionalFields(a);else this._populateOptionalFields(a)},_hideOptionalFields:function(f){var c=["FirstName","LastName","DateOfBirthStr","Email"];if(f.Email)$afe.select("#Email").val(f.Email).trigger("change").prop("readonly",true).prev("label").removeClass("required");else c.pop();for(var e=$afe.select(".signupStep.userinfo input, .signupStep.userinfo select"),b=null,g="",d=$afe.select(".signupStep.userinfo fieldset").first().find("fieldset"),a=0;a<e.length;a++){b=$afe.jq(e[a]);g=b.prop("id");if(c.indexOf(g)===-1){if(b.hasClass("completeworkflow"))continue;b.parent().remove()}}for(var a=0;a<d.length;a++){$fieldSet=$afe.jq(d[a]);$fieldSet.remove()}$afe.select("#HasLinkedPatient").val(1);$afe.select("#requiredFieldsText").addClass("hidden");this._shiftFieldsToOneColumn()},_shiftFieldsToOneColumn:function(){var b=$afe.select(".column").first(),a=$afe.select(".column").eq(1);if(a.length===0)return;var c=a.children();b.append(c)},_populateOptionalFields:function(a){var i="disabled",o="#AddressLine2",e="required",d="label",b=true,f="readonly",c="change";a.Email&&$afe.select("#Email").val(a.Email).trigger(c).prop(f,b).prev(d).removeClass(e);a.MobilePhone&&$afe.select("#MobilePhone").val(a.MobilePhone).trigger(c).prop(f,b).prev(d).removeClass(e);a.StreetAddressArray[0]&&$afe.select("#AddressLine1").val(a.StreetAddressArray[0]).trigger(c).prop(f,b).prev(d).removeClass(e);if(a.StreetAddressArray[1])$afe.select(o).val(a.StreetAddressArray[1]).trigger(c).prop(f,b).prev(d).removeClass(e);else a.StreetAddressArray[0]&&$afe.select(o).hide();a.City&&$afe.select("#City").val(a.City).trigger(c).prop(f,b).prev(d).removeClass(e);a.ZipCode&&$afe.select("#PostalCode").val(a.ZipCode).trigger(c).prop(f,b).prev(d).removeClass(e);a.StateCategory&&$afe.select("#State").val(a.StateCategory).trigger(c).prop(i,b).prev(d).removeClass(e);if(a.Race[0]){var j=$afe.select("#Race"),m=false,k=null;if(!$$WPUtil.IsNullOrEmpty(j[0])){for(var g=0;g<j[0].length;g++){k=j[0][g];if(a.Race.indexOf(k.value)!==-1){k.selected=b;m=b}}if(m){j.trigger(c).prop(i,b).prev(d).removeClass(e);$afe.select(".multiSelectHelpText").remove()}}}a.Ethnicity&&$afe.select("#Ethnicity").val(a.Ethnicity).trigger(c).prop(i,b).prev(d).removeClass(e);if(a.PreferredLanguageCategoryId){var h=$afe.select("#PreferredLanguage"),n=null,l=false;if(!$$WPUtil.IsNullOrEmpty(h[0])){for(var g=0;g<h[0].length;g++){n=h[0][g];if(n.value==a.PreferredLanguageCategoryId)l=b}!l&&h.append($afe.jq($("<option></option>").val(a.PreferredLanguageCategoryId).html(a.PreferredLanguageTitle)));h.val(a.PreferredLanguageCategoryId).trigger(c).prop(i,b).prev(d).removeClass(e)}}},_selectSlot:function(c,d){var a=this,b=null,e=null;a.ExecuteDeselectSlotHandler();e=a._getSlotDetails(c);b=$.proxy(function(e,b,a){this._showSlotDetailsWrapper(e,b,a,d,c)},a);if(a._isReservationEnabled())a._makeReservation(e,d,b,c);else b()},_getSlotDetails:function(c){var b=this,g=c.safeAttr("data-slot-daykey"),e=c.safeAttr("data-slot-index"),a=b._scheduleDays.AllDays[g],h=a.Slots[e],d=b._scheduleDays.AllDepartments[a.DepartmentID],f=b._scheduleDays.AllProviders[a.ProviderID];return b._BuildSlotDetails(a,h,f,d)},_showSlotDetailsWrapper:function(i,g,h,j,b){var a=this,f,d;f=b.safeAttr("data-slot-daykey");d=b.safeAttr("data-slot-index");var c="",e=null;e=a._scheduleDays.AllDays[f];b.addClass("selected").removeClass("dismissed");a.ResetModifiedButtons();a.MarkButtonAsModified(b[0]);a.HideOtherSlots(b.closest(".moreslots"));if(!!e.Slots[d].SlotProviderId||!g)c=e.ProviderID;else c=g;a.ShowSlotDetails(a,f,d,i,c,h,j)},_buildCaptchaContainer:function(){var b=null,a=b,e=b,d=b,c=b;if($$WP.Captcha.prototype.Type==="visible"){if(this._isRestrictedAccessMode()){c={ValidationSettings:new $$WP.FormValidation.ValidationSettings({required:true,isDate:true,maxDate:new Date,minDate:new Date(1900,0,0)})};$$WP.Strings.addMnemonic("@MYCHART@PATIENTFIRSTNAME@",this._settings._firstNameFromAccessCode);a=$afe.renderTemplate($$WP.Templates.OpenScheduling.DateOfBirthVerification,c);$$WP.FormValidation.initializeDOMSubtree(a);showLightBox(a.html());$el=$afe.select(".verificationForm");$el.submit(function(a){a.preventDefault()})}else{a=document.createElement("div");a.className="visibleCaptchaContainer";resetLightbox();showLightBox(a.outerHTML)}e=$afe.select(".visibleCaptchaContainer");d=$afe.select("#captchaConfirm");d.on("click",$.proxy(function(){this._onCaptchaContinue()},this))}return e},_isRestrictedAccessMode:function(){return!$$WPUtil.IsNullOrEmpty(this._settings._accessCode)&&this._isDemographicAuthenticationRequired()},_isDemographicAuthenticationRequired:function(){return this._settings._isDemographicAuthenticationRequired==="True"},_onCaptchaContinue:function(){var c="#DOBVerify",a=this,b="";if(a._isRestrictedAccessMode()){b=$afe.select(c).val();$afe.select(c).trigger("change");if(!$$WP.FormValidation.checkIfFormIsValid($afe.select("form.verificationForm"),false))return false}if(!a._captchaToken&&$$WPUtil.GetStringResource(a._GUID,"isDemoMode")!=="True"){a._captchaObj.ShowError();return}a._createPreloginSession(a._captchaToken,$.proxy(function(a){resetLightbox();this._selectSlot(this._selectedSlotEle,a.SessionToken)},a),a._settings._accessCode,b,a._settings._sourceToken)},_isDayOverlap:function(b,c,a){var d=this._isDaysEquivalent(b,c);return d?this._isSlotInScheduleDay(b,a)&&this._isSlotInScheduleDay(c,a):false},_isSlotInScheduleDay:function(d,e){var b=false,c,a;for(a in d.Slots){c=d.Slots[a];if(c.AppointmentTime===e)b=true}return b},_isDaysEquivalent:function(a,b){return a.VisitTypeInfo.IsAdvanced&&b.VisitTypeInfo.IsAdvanced&&a.VisitTypeID===b.VisitTypeID&&a.DepartmentID===b.DepartmentID&&a.Date===b.Date&&a.ProviderID!==b.ProviderID},_buildProviderIdListForReservation:function(d,a){var b=[],c=null,e=null,f=a.VisitTypeInfo.IsAdvanced&&a.VisitTypeInfo.GroupByDepartment;if(!!d.SlotProviderId)b.push(d.SlotProviderId);else b.push(a.ProviderID);if(f)for(e in this._scheduleDays.AllDays){c=this._scheduleDays.AllDays[e];this._isDayOverlap(c,a,d.AppointmentTime)&&b.push(c.ProviderID)}return b},_makeReservation:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_makeReservation(a,e,d,f){var c={},b=null;b=function(b){this._onAfterReserve(b.CanUseSlot,b.IsSessionExpired,b.ReservationKey,b.UsedProviderId,a.DepartmentId,a.VisitTypeId,a.Date,a.StartTime,b.ExpirationTime,d,f)};c={providerIdList:a.ProviderIdList,baseProviderId:a.ProviderId,departmentId:a.DepartmentId,visitTypeId:a.VisitTypeId,date:a.Date,startTime:a.StartTime,duration:a.Duration,clientTimeZoneOffset:(new Date).getTimezoneOffset(),sessionToken:e,primaryProvLengthInMin:a.PrimaryProvLengthInMin};$.ajax({url:makeLink("OpenScheduling/OpenScheduling/MakeReservation"),type:"POST",data:$$WPUtil.postify(c),success:b,context:this})},_onAfterReserve:function(j,c,b,d,h,i,e,k,g,f,l){var a=this;if(c)a._sessionToken="";if(j){!!b&&a._setOnDeselectSlotHandler(d,h,i,e,k,b);f(b,d,g)}else if(c)a._selectSlotWithSession(l);else a._onReservationFail()},_setOnDeselectSlotHandler:function(c,d,e,a,f,b){this._onDeselectSlotHandler=$.proxy(function(g){this._deleteReservation(c,d,e,a,f,b,g)},this);WP.Events.addListener(window,"beforeunload",this._onDeselectSlotHandler)},_onReservationFail:function(){var a=this,e=null,b="",c="",d=[];d.push(new $$WPComp.ComplexObjects.Button($$WPUtil.GetStringResource(a._GUID,"refreshSlotsButtonCaption")));b=$$WPUtil.GetStringResource(a._GUID,"slotSelectFailMessage");c=$$WPUtil.GetStringResource(a._GUID,"slotSelectFailTitle");e=$$WPUtil.quickMessageBox(b,c,d,$.proxy(a._reloadSlots,a),null,"Popup");e.OnCloseCallback=$.proxy(a._reloadSlots,a)},_reloadSlots:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_reloadSlots(){this.ResetSlots();this.ShowNextDays(true)},_deleteReservation:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_deleteReservation(f,d,e,h,g,c,b){var a={};a={providerId:f,departmentId:d,visitTypeId:e,date:h,startTime:g,reservationKey:c};$.ajax({url:makeLink("OpenScheduling/OpenScheduling/DeleteReservation"),type:"POST",data:a,context:this,success:b})},_isReservationEnabled:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_isReservationEnabled(){return $$WPUtil.GetStringResource(this._GUID,"isReservationEnabled")==="True"},_canShowVisitDuration:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_canShowVisitDuration(){return $$WPUtil.GetStringResource(this._GUID,"canShowVisitDuration")==="True"},_findScrollingElement:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_findScrollingElement(){return window.innerWidth<=this._settings._BreakpointWidth?$$WPUtil.GetUniqueJQueryById(this._GUID,"OpeningsContainer"):$$WPUtil.GetUniqueJQueryById(this._GUID,"OpeningsData")},_isScrolledToBottom:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_isScrolledToBottom(b){if(this._isPostLoginWidget()){if($$WPUtil.GetUniqueJQueryById(this._GUID,"OpeningsData").parents(".stepContainer").hasClass("offscreen"))return false;var c=$afe.select(".openingsData").contentHeight(),a=$afe.jq(window).scrollTop();return c<=window.innerHeight+a}else return $$WPUtil.ElementHasScrolledToBottom(b)},HideOtherSlots:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$PopulateResultsTable$HideOtherSlots(a){var c=".slotdetailaction.selected",b="dismissed";a.find(".slotdetailaction").addClass(b);if(a.find(c).length>0)a.find(c).removeClass(b);else a.find(".slotdetailaction.firstslot").removeClass(b);a.removeClass("hover")},PopulateFilteringTemplate:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$PopulateFilteringTemplate(y,x){var v=".scrollable",u="mousewheel",t=".selectAll, .selectNone",j="data-toggle-for",n=".optionsgroup",e="click",s=".timeFilter",i=".hidden",m=".filter:checked",b="disabled",l=".applyFilter",c="selected",q="[data-filter-group=",p="data-filter-group",h=".filter",k="hidden",d=true,f=this,a,g,w,r,o;g=f;f.__initializeDateAndFormValidation(x);a=$afe.renderTemplate($$WP.Templates.OpenScheduling.OpeningsFilters,f.__filtersViewModel);$$WPUtil.GetUniqueJQueryById(f._GUID,"filterContainer").empty().safeAppend(a);var z=makeStaticLink("images/calendar.svg");f.__setUpCalendar(z);f._populateColumns("peopleFilterColumn",$$WPUtil.GetUniqueJQueryById(f._GUID,"filterControls_0_peopleColContainer"),f._scheduleDays.AllProviders,f._scheduleDays.NumProviders);f.PopulateDepartmentFilter();g._ApplyFilterSelection(a,d);y&&$$WPUtil.GetUniqueJQueryById(f._GUID,"peopleFieldSet").addClass(k);a.off("change",h);a.on({change:function(n){var j=".selectAll",f=".selectNone",d,e,k;e=$afe.jq(n.target);k=e.safeAttr(p);d=a.find(q+k+"]");if(n.target.checked){g.AddFilter(k,e.val());e.parent().addClass(c);d.filter(l).removeClass(b);d.filter(f).removeClass(b);d.filter(m).not(i).length===d.filter(h).not(i).length&&d.filter(j).addClass(b)}else{g.RemoveFilter(k,e.val());e.parent().removeClass(c);d.filter(j).removeClass(b);if(d.filter(m).length===0){d.filter(l).addClass(b);d.filter(f).addClass(b)}}}},h);a.off("change",s);a.on({change:function(){var b;if(this.checked){b=a.find(".timeOfDay .toggleButton");b.removeClass(c);$afe.jq(this).parent().addClass(c)}}},s);a.find(h).not(i).prop("checked",d);a.find(h).change();a.off(e,n);a.on({click:function(a){a.stopPropagation()}},n);o=function Epic$PatientAccess$Controllers$ScheduleOpeningsController$PopulateFilteringTemplate$clickAwayFn(){var b;$afe.select("body").off(e,o);if($$WPUtil.IsNullOrEmpty($afe.jq(this).safeAttr(j)))b=null;else{b=this;var d=$afe.select("#"+$afe.jq(this).safeAttr(j));d.find(m).length===0&&d.find("a.selectAll").click()}$.each(a.find(n),function(d,a){$$WPUtil.SetElementToggled(a,b,false,"",k,c,"")});g._FiltersHaveChanged()&&g._ApplyFilterSelection(a)};a.off(e,t);a.on({click:function(g){var c,d,f;c=$afe.jq(this);if(!c.hasClass(b)){f=c.safeAttr(p);d=a.find(q+f+"]");if(c.hasClass("selectAll"))d.filter(h).not(i).not(":checked").trigger(e);else d.filter(":checked.filter").trigger(e)}g.preventDefault()}},t);a.off(e,l);a.on({click:function(a){!$afe.jq(this).hasClass(b)&&o();a.preventDefault()}},l);w=g._scheduleDays.NumProviders===1;r=g._scheduleDays.NumDepartments===1;$.each(a.find(".filterControl"),function(i,h){var f,a;a=$afe.jq(h).find(".filterValue");f=a.safeAttr("data-name");if(f==="people"&&w){a.click(function(){return false});a.addClass("onlyone").prop(b,d)}else{f==="locations"&&r&&$afe.select("#locationGroup").addClass("onlyone").find(".prettycheck").removeClass("prettycheck");$$WPUtil.AddToggleListener("",a.safeAttr("id"),e,c,"","",k,$afe.select(n),d,function(c,b){if(c===d)o();else{g._PreviousFilters=$.extend(d,{},g._Filters);$afe.select("body").click($.proxy(o,b.currentTarget));var a=$afe.select("#"+$afe.jq(b.currentTarget).safeAttr(j));a.length&&a.offset().left<-10&&a.css("right",a.offset().left-10)}})}});if(navigator.userAgent.match(/Trident\/7./)){a.off(u,v);a.on(u,v,function(b){var a=$afe.jq(this);a.height()<a.find(".scrollContainer").height()&&b.stopPropagation()})}},__initializeDateRange:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__initializeDateRange(b){var a=this,c=[],f=null,e=0,d=0;a.__minFromDaysOffset=null;a.__maxToDaysOffset=null;a.__checkAndRelaxDateOffsets(a._settings.__schedulingMinSearchOffset,a._settings.__schedulingMaxSearchOffset);if(!$$WPUtil.IsNullOrEmpty(b)){f=b.ID;e=b.FromDaysOffset;d=b.ToDaysOffset}a.__checkAndRelaxDateOffsets(e,d);c=a.__getSelectedDepartmentsList();a.__updateDateOffsetsBasedOnDepartment(c);a.__updateDateOffsetsBasedOnVisitTypeInDepartment(c,f);if($$WPUtil.IsNullOrEmpty(a.__minFromDaysOffset))a.__minFromDaysOffset=a._settings.__openSchedMinSearchOffset;if($$WPUtil.IsNullOrEmpty(a.__maxToDaysOffset))a.__maxToDaysOffset=a._settings.__openSchedMaxSearchOffset;var g=WP.Utils.date2dte(new Date);a.__minDte=g+a.__minFromDaysOffset;a.__maxDte=g+a.__maxToDaysOffset},__getSelectedDepartmentsList:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__getSelectedDepartmentsList(){var b=[],a=null;for(a in this._scheduleDays.AllDepartments){if(!this._scheduleDays.AllDepartments.hasOwnProperty(a))continue;b.push(this._scheduleDays.AllDepartments[a])}return b},__updateDateOffsetsBasedOnDepartment:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__updateDateOffsetsBasedOnDepartment(g){var e=null,h=0,i=e,d=e,c=e,b=e,a=e,f=0;h=g.length;if(h===1){i=g[0];d=i.FromDaysOffset;c=i.ToDaysOffset}else for(f=0;f<h;f++){b=g[f].FromDaysOffset;a=g[f].ToDaysOffset;if($$WPUtil.IsNullOrEmpty(b)&&$$WPUtil.IsNullOrEmpty(a))break;if($$WPUtil.IsNullOrEmpty(d)||!$$WPUtil.IsNullOrEmpty(b)&&b<d)d=b;if($$WPUtil.IsNullOrEmpty(c)||!$$WPUtil.IsNullOrEmpty(a)&&a>c)c=a}this.__checkAndRelaxDateOffsets(d,c)},__updateDateOffsetsBasedOnVisitTypeInDepartment:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__updateDateOffsetsBasedOnVisitTypeInDepartment(j,l){var c=null,e=c,d=c,k=0,g=c,b=c,a=c,f=c,h=0,i=0;k=j.length;for(h=0;h<k;h++){g=j[h].DepartmentVisitTypeOverrides;if($$WPUtil.IsNullOrEmpty(g[0]))continue;for(i=0;i<g.length;i++){f=g[i];if(!$$WPUtil.IsNullOrEmpty(f)&&f.VisitTypeID===l){b=f.FromDaysOffset;a=f.ToDaysOffset;if($$WPUtil.IsNullOrEmpty(e)&&!$$WPUtil.IsNullOrEmpty(b))e=b;else if(!$$WPUtil.IsNullOrEmpty(b)&&b<e)e=b;if($$WPUtil.IsNullOrEmpty(d)&&!$$WPUtil.IsNullOrEmpty(a))d=a;else if(!$$WPUtil.IsNullOrEmpty(a)&&a>d)d=a}}}this.__checkAndRelaxDateOffsets(e,d)},__checkAndRelaxDateOffsets:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__checkAndRelaxDateOffsets(b,a){if($$WPUtil.IsNullOrEmpty(b)&&$$WPUtil.IsNullOrEmpty(a))return;this.__setMinDateOffset(b);this.__setMaxDateOffset(a)},__setMinDateOffset:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__setMinDateOffset(b){var a=this;if($$WPUtil.IsNullOrEmpty(b))a.__minFromDaysOffset=a._settings.__openSchedMinSearchOffset;else if(b>a._settings.__openSchedMinSearchOffset)a.__minFromDaysOffset=b;else a.__minFromDaysOffset=a._settings.__openSchedMinSearchOffset},__setMaxDateOffset:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__setMaxDateOffset(b){var a=this;if($$WPUtil.IsNullOrEmpty(b))a.__maxToDaysOffset=a._settings.__openSchedMaxSearchOffset;else if(b<a._settings.__openSchedMaxSearchOffset)a.__maxToDaysOffset=b;else a.__maxToDaysOffset=a._settings.__openSchedMaxSearchOffset},_populateColumns:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_populateColumns(d,e,b){var a,c={};for(a in b){if(!b.hasOwnProperty(a))continue;c[a]=b[a]}$$WPUtil.PopulateComplexTemplate(this._GUID,d,null,c,null,0).safeAppendTo(e)},PopulateDepartmentFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$PopulateDepartmentFilter(){var e="hidden",k="filterControls_0_locationsLoadMore",j="filterControls_0_locationsColContainer",h=true,g=false,f=this,b=f,a=[],l=g,d;for(d in f._scheduleDays.AllDepartments){if(!f._scheduleDays.AllDepartments.hasOwnProperty(d))continue;a.push(f._scheduleDays.AllDepartments[d])}if(($$WPUtil.IsNullOrEmpty(b._searchLatitude)||$$WPUtil.IsNullOrEmpty(b._searchLongitude))&&($$WPUtil.IsNullOrEmpty(b._geolocationLatitude)||$$WPUtil.IsNullOrEmpty(b._geolocationLongitude)))for(d in a){if(!a.hasOwnProperty(d))continue;a[d].Distance=null}a.sort(function(a,b){return $$WPUtil.IsNullOrEmpty(b.Distance)?$$WPUtil.IsNullOrEmpty(a.Distance)?a.Name.localeCompare(b.Name):-1:$$WPUtil.IsNullOrEmpty(a.Distance)?1:a.Distance-b.Distance});if($$WPUtil.IsNullOrEmpty(b._searchLatitude)||$$WPUtil.IsNullOrEmpty(b._searchLongitude))for(d in a){if(!a.hasOwnProperty(d))continue;a[d].IsFiltered=g}else for(var c=0;c<a.length;c++)if(!$$WPUtil.IsNullOrEmpty(a[c].Distance)&&a[c].Distance>b._distanceToNeverIncludeDepartments){a[c].IsFiltered=h;l=h}else if(!$$WPUtil.IsNullOrEmpty(a[c].Distance)&&a[c].Distance<b._distanceToAlwaysIncludeDepartments)a[c].IsFiltered=g;else if(c<b._numberOfDepartmentsOnFirstLoad)a[c].IsFiltered=g;else{a[c].IsFiltered=h;l=h}$$WPUtil.GetUniqueJQueryById(f._GUID,j).empty().safeAppend($afe.renderTemplate($$WP.Templates.OpenScheduling.DepartmentFilter,a));var i=$$WPUtil.GetUniqueJQueryById(f._GUID,k),m=$$WPUtil.GetUniqueJQueryById(b._GUID,j);if(l){i.removeClass(e);i.find("a").off("click").on("click",function(a){a.preventDefault();m.find("div.hidden").removeClass(e);m.find("input.hidden").removeClass(e);$$WPUtil.GetUniqueJQueryById(b._GUID,"locationsFieldSet").find("a.selectAll").removeClass("disabled");$$WPUtil.GetUniqueJQueryById(b._GUID,k).addClass(e);return g})}else i.addClass(e);b.ClearDepartmentFilters();$$WPUtil.GetUniqueJQueryById(f._GUID,j).find(".filter").not(".hidden").each(function(){b.AddDepartmentFilter($afe.jq(this).val())})},_DistanceFromSearch:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_DistanceFromSearch(a){function degreesToRadians(a){return a*Math.PI/180}if($$WPUtil.IsNullOrEmpty(a.Latitude)||$$WPUtil.IsNullOrEmpty(a.Longitude))return null;var d=degreesToRadians(parseFloat(a.Latitude)),f=degreesToRadians(parseFloat(a.Longitude)),e=degreesToRadians(parseFloat(this._searchLatitude)),g=degreesToRadians(parseFloat(this._searchLongitude)),c=d-e,b=f-g;return 7917.5*Math.asin(Math.sqrt(Math.sin(c/2)*Math.sin(c/2)+Math.cos(d)*Math.cos(e)*Math.sin(b/2)*Math.sin(b/2)))},_FiltersHaveChanged:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_FiltersHaveChanged(){var c=true,a,b;a=false;b=this;a=b._Filters.TimesOfDay!==b._PreviousFilters.TimesOfDay;!a&&$.each(b._Filters.Providers,function(d){if($$WPUtil.IsNullOrEmpty(b._PreviousFilters.Providers[d]))a=c});!a&&$.each(b._PreviousFilters.Providers,function(d){if($$WPUtil.IsNullOrEmpty(b._Filters.Providers[d]))a=c});!a&&$.each(b._Filters.Departments,function(d){if($$WPUtil.IsNullOrEmpty(b._PreviousFilters.Departments[d]))a=c});!a&&$.each(b._PreviousFilters.Departments,function(d){if($$WPUtil.IsNullOrEmpty(b._Filters.Departments[d]))a=c});!a&&$.each(b._Filters.DaysOfWeek,function(d){if($$WPUtil.IsNullOrEmpty(b._PreviousFilters.DaysOfWeek[d]))a=c});!a&&$.each(b._PreviousFilters.DaysOfWeek,function(d){if($$WPUtil.IsNullOrEmpty(b._Filters.DaysOfWeek[d]))a=c});return a},_ApplyFilterSelection:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_ApplyFilterSelection(e,x){var t="dayFilterSeparator",w="dateTimeFilterButtonText",s="datetime",r="datetimeValue",v="someLocationsFilterButtonText",j="locationsValue",o="peopleValue",c="#",q=":checked",a=this,b,k,g,h,f,u,p,i,l,d,n,m;b=a._GUID+"_filterControls_0_";d="active";k=e.find(".personFilter");g=k.filter(q);if(a._scheduleDays.NumProviders===1){n=a.__getSelectedTextById(e,k);$afe.select(c+b+o).text(n)}else if(g.length===1){n=a.__getSelectedTextById(e,g);$afe.select(c+b+o).text(n).parent().addClass(d)}else if(g.length===0||g.length===k.length)$afe.select(c+b+o).text($$WPUtil.GetStringResource(a._GUID,"peopleFilterButtonAllText")).parent().removeClass(d);else $afe.select(c+b+o).text($$WPUtil.GetStringResource(a._GUID,"somePeopleFilterButtonText",{numPeopleSelected:g.length,totalPeople:k.length})).parent().addClass(d);h=e.find(".locationFilter");f=h.filter(q);if(f.length===0&&a._scheduleDays.NumDepartments>0)$afe.select(c+b+j).text($$WPUtil.GetStringResource(a._GUID,v,{numLocationsSelected:f.length,totalLocations:h.length})).parent().removeClass(d);else if(a._scheduleDays.NumDepartments===1){m=a.__getSelectedTextById(e,h);$afe.select(c+b+j).text(m)}else if(f.length===1){m=a.__getSelectedTextById(e,f);$afe.select(c+b+j).text(m).parent().addClass(d)}else if(f.length===h.length)$afe.select(c+b+j).text($$WPUtil.GetStringResource(a._GUID,"locationFilterButtonAllText")).parent().removeClass(d);else $afe.select(c+b+j).text($$WPUtil.GetStringResource(a._GUID,v,{numLocationsSelected:f.length,totalLocations:h.length})).parent().addClass(d);u=e.find(".dayFilter");p=u.filter(q);i=e.find(".timeFilter:checked");if(p.length===0||p.length===u.length)if(i.val()==="am")$afe.select(c+b+r).text($$WPUtil.GetStringResource(a._GUID,"timeFilterButtonAMText")).parent().addClass(d);else if(i.val()==="pm")$afe.select(c+b+r).text($$WPUtil.GetStringResource(a._GUID,"timeFilterButtonPMText")).parent().addClass(d);else $afe.select(c+b+r).text($$WPUtil.GetStringResource(a._GUID,"dateTimeFilterButtonAllText")).parent().removeClass(d);else{l=[];$.each(p,$.proxy(function(b,a){l.push($$WPUtil.GetStringResource(this._GUID,"dayAbbreviation_"+$afe.jq(a).val()))},a));if(i.val()==="am")$afe.select(c+b+s).text($$WPUtil.GetStringResource(a._GUID,w,{days:l.join($$WPUtil.GetStringResource(a._GUID,t)),times:$$WPUtil.GetStringResource(a._GUID,"timeFilterButtonAMWithDaysText")})).parent().addClass(d);else if(i.val()==="pm")$afe.select(c+b+s).text($$WPUtil.GetStringResource(a._GUID,w,{days:l.join($$WPUtil.GetStringResource(a._GUID,t)),times:$$WPUtil.GetStringResource(a._GUID,"timeFilterButtonPMWithDaysText")})).parent().addClass(d);else $afe.select(c+b+s).text($$WPUtil.GetStringResource(a._GUID,"dateFilterButtonText",{daysonly:l.join($$WPUtil.GetStringResource(a._GUID,t))})).parent().addClass(d)}if(x!==true){a.ResetSlots();if(a.__firstDteToShow!==0&&!$$WPUtil.IsNullOrEmpty(a.__firstDteToShow))a.__isNewDateSelected=true;a.ShowNextDays()}},__getSelectedTextById:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__getSelectedTextById(a,b){return a.find('[for="'+b.safeAttr("id")+'"]').text()},ClearAllFilters:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ClearAllFilters(){var a=this;a.ClearDepartmentFilters();a.ClearProviderFilters();a.ClearDayFilter();a.SetTimeOfDayFilter(a.TimeOfDayEnum.Both)},AddFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$AddFilter(c,b){var a=this;switch(c){case"locations":a.AddDepartmentFilter(b);break;case"people":a.AddProviderFilter(b);break;case"days":a.AddDayFilter(b);break;case"times":a.SetTimeOfDayFilter(b)}},RemoveFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$RemoveFilter(c,b){var a=this;switch(c){case"locations":a.RemoveDepartmentFilter(b);break;case"people":a.RemoveProviderFilter(b);break;case"days":a.RemoveDayFilter(b);break;case"times":a.SetTimeOfDayFilter(b)}},AddDepartmentFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$AddDepartmentFilter(a){this._Filters.Departments[a]=true;this._visibleDepartments[a]=true},RemoveDepartmentFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$RemoveDepartmentFilter(a){delete this._Filters.Departments[a];delete this._visibleDepartments[a]},ClearDepartmentFilters:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ClearDepartmentFilters(){this._Filters.Departments={};this._visibleDepartments=[]},AddProviderFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$AddProviderFilter(a){this._Filters.Providers[a]=true},RemoveProviderFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$RemoveProviderFilter(a){delete this._Filters.Providers[a]},ClearProviderFilters:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ClearProviderFilters(){this._Filters.Providers={}},AddDayFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$AddDayFilter(a){this._Filters.DaysOfWeek[a]=true},RemoveDayFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$RemoveDayFilter(a){delete this._Filters.DaysOfWeek[a]},ClearDayFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ClearDayFilter(){this._Filters.DaysOfWeek={}},SetTimeOfDayFilter:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$SetTimeOfDayFilter(a){this._Filters.TimesOfDay=a},ShowSlotDetails:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ShowSlotDetails(b,l,k,i,c,e,j){var a,d,f,h,g;a=b._scheduleDays.AllDays[l];d=a.Slots[k];f=b._scheduleDays.AllDepartments[a.DepartmentID];b._selectedProviderId=a.ProviderID;h=b._scheduleDays.AllProviders[c];$$WPUtil.LogAction(b._GUID,"SelectSlot",{provider:c,linksource:$$WPUtil.queryString("linksource"),department:a.DepartmentID,visittype:a.VisitTypeID});g={date:a.DateISO,time:d.StartTimeISO,providerid:c,departmentid:a.DepartmentID,visittypeid:a.VisitTypeID,ReservationKey:i,SessionToken:j,ReservationExpirationTime:e};b._PopulateSlotDetails(b,g,b._BuildSlotDetails(a,d,h,f,e))},ShowPreselectedSlotDetails:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ShowPreselectedSlotDetails(a,d,g){var c=this,e=null,b=null,f="";c._sessionToken=a.SessionToken;b=c._BuildSlotDetails(d.scheduleDay,d.scheduleDay.Slots[0],d.provider,d.department,a.reservationExpirationTime);e=function(){var a=$$WPUtil.GetUniqueJQueryById(this._GUID,"apptDetailsControlsContainer").find(".scheduleaction");a.on("click",g);a.click()}.bind(c);c._PopulateSlotDetails(c,a,b,e);f=a.slotProviderId?a.slotProviderId:a.providerid;c._setOnDeselectSlotHandler(f,b.DepartmentId,b.VisitTypeId,b.Date,b.StartTime,a.ReservationKey)},_BuildSlotDetails:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_BuildSlotDetails(c,a,d,b,h){var f=c.VisitTypeInfo.IsAdvanced&&c.VisitTypeInfo.GroupByDepartment,e,g=[];if(f||$$WPUtil.IsNullOrEmpty(d.PhotoUrl))e="";else e=d.PhotoUrl;g=this._buildProviderIdListForReservation(a,c);return{VisitTypeId:c.VisitTypeID,VisitTypeName:c.VisitTypeName,Date:c.DateISO,FormattedDate:c.DisplayDate,StartTime:a.StartTimeISO,FormattedStartTime:a.FormattedStartTimeLong,AppointmentTime:a.AppointmentTimeISO,ArrivalTime:a.ArrivalTimeISO,FormattedArrivalTime:a.FormattedArrivalTimeLong,CanShowAppointmentTime:a.CanShowAppointmentTime,Duration:a.DurationInMinutes,PrimaryProvLengthInMin:a.PrimaryProvLengthInMin,ProviderId:d.ID,ProviderName:f?null:d.DisplayName,SlotProviderId:a.SlotProviderId,ProviderIdList:g,ProviderPhotoUrl:e,CanShowDepartment:!c.VisitTypeInfo.IsTelemedicine,DepartmentId:b.ID,DepartmentName:b.Name,DepartmentUrl:b.HomepageUrl,DepartmentPhotoUrl:b.PhotoUrl,DepartmentAddress:b.FormattedAddress,DepartmentPhone:b.PhoneForScheduling?b.PhoneForScheduling:b.Phone,LocationInstructions:b.LocationInstructions,ReservationExpirationTime:h}},_PopulateSlotDetails:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$ShowSlotDetails(b,g,a,d){var c,f,e="";c=$$WPUtil.GetUniqueJQueryById(b._GUID,"slotDetails");c.empty();e=a.ReservationExpirationTime?$$WPUtil.GetStringResource(b._GUID,"reservationExpirationBlurb",{ReservationExpirationTime:a.ReservationExpirationTime}):"";f={VisitType:a.VisitTypeName,Date:a.FormattedDate,Time:a.FormattedStartTime,ArrivalTimeLabel:a.FormattedArrivalTime?$$WPUtil.GetStringResource(b._GUID,"arrivalTimeLabel",{ArrivalTime:a.FormattedArrivalTime}):"",CanShowAppointmentTime:a.CanShowAppointmentTime,AppointmentTimeLabel:a.FormattedStartTime?$$WPUtil.GetStringResource(b._GUID,"appointmentTimeLabel",{AppointmentTime:a.FormattedStartTime}):"",DurationString:a.Duration&&this._canShowVisitDuration()?$$WPUtil.GetStringResource(b._GUID,"durationString",{Duration:a.Duration}):"",ProviderName:a.ProviderName,ProviderPhotoUrl:a.PhotoUrl,CanShowDepartment:a.CanShowDepartment,DepartmentName:a.DepartmentName,DepartmentUrl:a.DepartmentUrl,DepartmentPhotoUrl:a.DepartmentPhotoUrl,DepartmentAddress:a.DepartmentAddress,DepartmentPhone:a.DepartmentPhone,LocationInstructions:a.LocationInstructions,ReservationExpirationBlurb:e};b.HideSlotDetails(b,function(){c.empty().safeAppend($afe.renderTemplate($$WP.Templates.OpenScheduling.SlotDetails,f));$$WPUtil.GetUniqueJQueryById(b._GUID,"apptDetailsControlsContainer").find(".scheduleaction").off("click").click(function(c){c.preventDefault();if(!b._ValidateAppointmentComments(b))return;b.AttemptToSchedule(b,g,a);b._settings._LoginSignupController&&b._settings._LoginSignupController.SignupController.MatchStepHeights()});typeof b._settings._showDetailsCallback==="function"&&b._settings._showDetailsCallback();d&&d()})},_ValidateAppointmentComments:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_ValidateAppointmentComments(d){var b=false,e=$$WPUtil.GetUniqueJQueryById(d._GUID,"slotDetailsContainer"),a=e.find("div.comments"),c=0;if(!a.length||!a[0].children.length)return true;b=$$WP.FormValidation.checkIfFormIsValid(a.find("form"),false);if(!b){a.find("[name='Comments']").trigger("change");if(d._settings._isEmbedded){c=a.position().top;$afe.select(".slotDetailsContainer.stepContainer.scrollable").scrollTop(c);$afe.select("html, body").scrollTop(c)}}return b},_UpdateAppointmentComments:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$UpdateAppointmentComments(c){var b=this,d=null,e=null,a={showComments:false,requireComments:false,commentsValidationSettings:null,appointmentComments:""};a.showComments=b._settings.__showAppointmentComment!==b._settings.__showAppointmentCommentEnum.Hide;a.requireComments=b._settings.__showAppointmentComment===b._settings.__showAppointmentCommentEnum.ShowRequired;a.appointmentComments=b._settings._appointmentComments;if(c!==b._settings.__showAppointmentCommentVTEnum.NotSet){a.showComments=c!==b._settings.__showAppointmentCommentVTEnum.DoNotAskComments;a.requireComments=c===b._settings.__showAppointmentCommentVTEnum.AskAndRequireComment}a.commentsValidationSettings=new $$WP.FormValidation.ValidationSettings({required:a.requireComments,maxLength:250});d=$$WPUtil.GetUniqueJQueryById(b._GUID,"slotDetailsContainer");e=$afe.renderTemplate($$WP.Templates.OpenScheduling.AppointmentComments,a);d.find("div.comments").safeReplaceWith(e);a.showComments&&$$WP.FormValidation.initializeDOMSubtree(d)},_PopulateProviderInfo:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_PopulateProviderInfo(a,b,c){$.each($$WPUtil.GetUniqueJQueryById(a._GUID,"OpeningsData").find("."+b+"_infoCell"),function(f,e){var d,b;b=$afe.jq(e);d=b.find(".infowrapper").empty();$$WPUtil.PopulateComplexTemplate(a._GUID,"providerInfoContainer",d,{ProvInfo:$$WPUtil.SerializeNodes(c)});b.addClass("infoLink")})},_GetAndStoreInfoForProvider:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_GetAndStoreInfoForProvider(a){var d,c,b;b=this;if($$WPUtil.IsNullOrEmpty(a))return;if($$WPUtil.IsNullOrEmpty(a.ID))return;d=a.InfoUrl;if(!$$WPUtil.IsNullOrEmpty(d))$.get(d,"",function(d){c=dangerou$.parseHtml(d);if($$WPUtil.IsNullOrEmpty(d)||c.length<1)b._providerInfo[a.ID]=null;else{b._providerInfo[a.ID]=c;b._PopulateProviderInfo(b,a.ID,c)}});else b._providerInfo[a.ID]=null},HideSlotDetails:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$HideSlotDetails(a,b){a._settings._detailsContainer!==null&&typeof a._settings._hideDetailsCallback==="function"&&a._settings._hideDetailsCallback(b)},AttemptToSchedule:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$AttemptToSchedule(k,e,i){var f="beforeunload",d="function",c=null,b=this,j,h,g,a;e.useMyChartContext=b._settings._useMyChartContext;e.isPostLogin=b._settings._isPostLogin;e.slotProviderId=i.SlotProviderId;e.comments=b._AppointmentDetailsController.GetComments();if(!e.comments)e.comments=b._settings._appointmentComments;b._settings._LoginSignupController.setSelectedSlot(e,i,b._onDeselectSlotHandler);a=b;if(b._settings._scheduleSuccessFunction!==c&&typeof b._settings._scheduleSuccessFunction===d)g=$.proxy(function(a){this._settings._scheduleSuccessFunction(a);!!this._onDeselectSlotHandler&&WP.Events.removeListener(window,f,this._onDeselectSlotHandler)},b);else g=$.proxy(function(b){if(b.action==="redirect"){!!this._onDeselectSlotHandler&&WP.Events.removeListener(window,f,this._onDeselectSlotHandler);WP.Events.cancelBeforeUnload();if((!b.method||b.method.toUpperCase()==="GET")&&!b.parameters)window.location.assign(b.url);else{var g,e='<form action="'+b.url+'" method="'+(b.method||"GET")+'">';for(g in b.parameters){if(!b.parameters.hasOwnProperty(g))continue;e=e+'<input type="hidden" name="'+g+'" value="'+b.parameters[g]+'" />'}e=e+"</form>";var h=dangerou$.parseHtml(e);$afe.select("body").safeAppend(h);h.submit()}}if(b.action==="lightbox"){a._settings._LoginSignupController.LoginController._clickBackButton();$$WPUtil.ShowUrlInLightbox(b.url,c,function(){$$WPUtil.GetUniqueJQueryById("9F690F61-B327-458C-A8C2-D7EC4BFCDDDB_error","errorAck").click(function(){$afe.select(".completeworkflow").prop("disabled",false);a._settings._LoginSignupController.ResetForms(a._settings._LoginSignupController);$$WPUtil.HideLightbox();a.__focusSlotHeader();if(a.__firstDteToShow!==0&&a.__firstDteToShow!==undefined)a.__isNewDateSelected=true;a.ClearScheduleDays();a.ShowNextDays(true);a._settings._scheduleSuccessLightboxCallback!==c&&typeof a._settings._scheduleSuccessLightboxCallback===d&&a._settings._scheduleSuccessLightboxCallback()})},a.__focusErrorPopupHeader,function(){a._settings._LoginSignupController.ResetForms(a._settings._LoginSignupController);a._settings._scheduleSuccessLightboxCallback!==c&&typeof a._settings._scheduleSuccessLightboxCallback===d&&a._settings._scheduleSuccessLightboxCallback()})}},b);j={url:k._settings._scheduleUrl,type:"post",data:e,dataType:"json",async:false,success:g,error:function(){$$WPUtil.ShowUrlInLightbox(this._errorUrl)}};h=new $$WPUtil.AuthenticatedCallManager;h.MakeAuthenticatedCall(j,b._settings._showAuthPaneFunction,!b._settings._useMyChartContext,function(){a._settings._LoginSignupController.ResetForms(a._settings._LoginSignupController)})},__focusErrorPopupHeader:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__focusErrorPopupHeader(){$afe.select(".errorpopup .error-title").focus()},__focusSlotHeader:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$__focusSlotHeader(){$afe.select(".slotStepHeader").focus()},_RegisterHandlebarsHelpers:function Epic$PatientAccess$Controllers$ScheduleOpeningsController$_RegisterHandlebarsHelpers(){var m="FormattedAddress",l="Distance",k="ProviderID",j="DepartmentID",f=true,i="locationFilterDepartmentDistance",e="number",c=null,b="",a=this,g=0,h=0,n=false,d,o;this._slotsPerRow=this.__baseSlotsPerRow;Handlebars.registerHelper("for",function(f,g,d,e){for(var c=b,a=f;a<g;a=a+d)c=c+e.fn(a);return c});Handlebars.registerHelper("getDayIndex",function(){return this+1});Handlebars.registerHelper("getDayName",function(){return new Handlebars.SafeString($$WPUtil.GetStringResource(a._GUID,"dayName_"+this))});Handlebars.registerHelper("hasGeolocationData",function(b){return a._geolocationLatitude!==c&&a._geolocationLongitude!==c?b.fn(this):b.inverse(this)});Handlebars.registerHelper("hasDistance",function(b){var a=this;return typeof a.Distance===e&&!isNaN(a.Distance)?b.fn(a):b.inverse(a)});Handlebars.registerHelper("getDistanceString",function(){var b=this;if(typeof b.Distance===e&&!isNaN(b.Distance))return b.Distance>150?new Handlebars.SafeString($$WPUtil.GetStringResource(a._GUID,"locationFilterDepartmentDistanceOverMaximum")):new Handlebars.SafeString($$WPUtil.GetStringResource(a._GUID,i,{DepartmentDistance:(Math.round((b.Distance+.001)*10)/10).toFixed(1)}))});Handlebars.registerHelper("setGroupByDepartment",function(){if(this.VisitTypeInfo)d=this.VisitTypeInfo.IsAdvanced&&this.VisitTypeInfo.GroupByDepartment;return b});Handlebars.registerHelper("isGroupByDepartment",function(a){return d?a.fn(this):a.inverse(this)});Handlebars.registerHelper("setCanShowAddress",function(){if(this.VisitTypeInfo)canShowAddress=!this.VisitTypeInfo.IsTelemedicine;else canShowAddress=f;return b});Handlebars.registerHelper("canShowAddress",function(a){return canShowAddress?a.fn(this):a.inverse(this)});Handlebars.registerHelper("getGuid",function(){return a._GUID});Handlebars.registerHelper("setDayKey",function(){var c=this,a,d;for(a in c.ProvidersAndHours){if(!c.ProvidersAndHours.hasOwnProperty(a))continue;for(d in c.ProvidersAndHours[a].HoursAndSlots)if(c.ProvidersAndHours[a].HoursAndSlots[d].Slots.length>0){o=c.ProvidersAndHours[a].HoursAndSlots[d].Slots[0].DayKey;break}}return b});Handlebars.registerHelper("getDayKey",function(){return o});Handlebars.registerHelper("getProvider",function(c){var b;if(d)b=a._scheduleDays.AllDepartments[this.ProviderID];else b=a._scheduleDays.AllProviders[this.ProviderID];return c==="PhotoUrl"?$$WPUtil.IsNullOrEmpty(b.PhotoUrl)?a._settings._DefaultThumbnailUrl:b.PhotoUrl:d&&c==="DisplayName"?b.Name:c==="HomePageUrl"?makeLink(b[c]):b[c]});Handlebars.registerHelper("hasUrl",function(c){var b=this;return d?c.inverse(b):a._scheduleDays.AllProviders[b.ProviderID].HomePageUrl?c.fn(b):c.inverse(b)});Handlebars.registerHelper("getDepartment",function(g){var f=this,d=c;if(f.hasOwnProperty(j))d=f.DepartmentID;else if(f.hasOwnProperty(k)){var h;for(h in f.DepartmentAndSlots){if(!f.DepartmentAndSlots.hasOwnProperty(h))continue;d=f.DepartmentAndSlots[h].DepartmentID;break}}if($$WPUtil.IsNullOrEmpty(d))return b;if(g===l)return typeof a._scheduleDays.AllDepartments[d].Distance===e&&!isNaN(a._scheduleDays.AllDepartments[d].Distance)?new Handlebars.SafeString($$WPUtil.GetStringResource(a._GUID,i,{DepartmentDistance:(Math.round((a._scheduleDays.AllDepartments[d].Distance+.001)*10)/10).toFixed(1)})):b;else if(g===m)if(a._scheduleDays.AllDepartments[d].FormattedAddress&&a._scheduleDays.AllDepartments[d].FormattedAddress.length>0){for(var n=b,o=0;o<a._scheduleDays.AllDepartments[d].FormattedAddress.length;o++)n=n+'<span class="departmentAddress subtle">'+HTMLEncode(a._scheduleDays.AllDepartments[d].FormattedAddress[o])+"</span><br />";return new Handlebars.SafeString(n)}else return b;else if(g==="AddressConcatenated"){var p=a._scheduleDays.AllDepartments[d].FormattedAddress;return Array.isArray(p)?new Handlebars.SafeString(HTMLEncode(p.join(" "))):b}else return a._scheduleDays.AllDepartments[d][g]});Handlebars.registerHelper("departmentHasProperty",function(h,n){var d=this,g=false,b=c;if(d.hasOwnProperty(j))b=d.DepartmentID;else if(d.hasOwnProperty(k)){var i;for(i in d.DepartmentAndSlots){if(!d.DepartmentAndSlots.hasOwnProperty(i))continue;b=d.DepartmentAndSlots[i].DepartmentID;break}}if($$WPUtil.IsNullOrEmpty(b))return n.inverse(d);if(h===m){if(a._scheduleDays.AllDepartments[b].FormattedAddress&&a._scheduleDays.AllDepartments[b].FormattedAddress.length>0)g=f}else if(h===l)g=typeof a._scheduleDays.AllDepartments[b].Distance===e&&!isNaN(a._scheduleDays.AllDepartments[b].Distance);else if(typeof a._scheduleDays.AllDepartments[b][h]!=="undefined"&&a._scheduleDays.AllDepartments[b][h]!==c)g=f;return g?n.fn(d):n.inverse(d)});Handlebars.registerHelper("resetSlotsCount",function(){g=0;return b});Handlebars.registerHelper("incrementSlotsCount",function(){g=g+1;return b});Handlebars.registerHelper("getSlotsCount",function(){return g});Handlebars.registerHelper("startSlotsRow",function(b){return g%a._slotsPerRow===1?b.fn(this):b.inverse(this)});Handlebars.registerHelper("closeSlotsRow",function(b){return g%a._slotsPerRow===0?b.fn(this):b.inverse(this)});Handlebars.registerHelper("startHidden",function(b){if(g===a._slotsPerRow+1){n=f;return b.fn(this)}else return b.inverse(this)});Handlebars.registerHelper("closeHidden",function(b){return g>a._slotsPerRow?b.fn(this):b.inverse(this)});Handlebars.registerHelper("resetSubSlotsCount",function(){h=0;return b});Handlebars.registerHelper("incrementSubSlotsCount",function(){h=h+1;return b});Handlebars.registerHelper("isOtherSubSlot",function(a){return h>1?a.fn(this):a.inverse(this)});Handlebars.registerHelper("showExpand",function(a){if(n){n=false;return a.fn(this)}else return a.inverse(this)});Handlebars.registerHelper("showProvider",function(b){var c=this;return d?$$WPUtil.IsNullOrEmpty(a._settings._departmentId)?b.fn(c):a._settings._departmentId.indexOf(",")<0?b.inverse(c):b.fn(c):$$WPUtil.IsNullOrEmpty(a._settings._providerId)?b.fn(c):a._settings._providerId.indexOf(",")<0?b.inverse(c):b.fn(c)});Handlebars.registerHelper("showProviderPhoto",function(a){return d?a.inverse(this):a.fn(this)});Handlebars.registerHelper("showDepartment",function(b){var c=this;return d?b.inverse(c):a._settings._isWizardMode?b.fn(c):$$WPUtil.IsNullOrEmpty(a._settings._departmentId)?a._scheduleDays.NumDepartments===1?b.inverse(c):b.fn(c):a._settings._departmentId.indexOf(",")<0?b.inverse(c):b.fn(c)});Handlebars.registerHelper("getString",function(e,c){var d=b;if(typeof c==="string"&&c!==b)d=c;else d=a._GUID;return new Handlebars.SafeString($$WPUtil.GetStringResource(d,e))});Handlebars.registerHelper("getTitleTextString",function(b){return new Handlebars.SafeString($$WPUtil.GetStringResource(a._GUID,"providerUrlTitleText",{providerUrlTitleTextProviderName:HTMLEncode(a._scheduleDays.AllProviders[b].DisplayName)}))});Handlebars.registerHelper("getAltTextString",function(b){return new Handlebars.SafeString($$WPUtil.GetStringResource(a._GUID,"providerPhotoAltText",{providerPhotoAltTextProviderName:HTMLEncode(a._scheduleDays.AllProviders[b].DisplayName)}))});Handlebars.registerHelper("getAccessibleSlotString",function(f,e,b,c){return new Handlebars.SafeString($$WPUtil.GetStringResource(a._GUID,"accessibleSlot",{accessibleSlotTime:f,accessibleSlotDate:e,accessibleSlotDepartment:HTMLEncode(a._scheduleDays.AllDepartments[b].Name),accessibleSlotProvider:HTMLEncode(d?a._scheduleDays.AllDepartments[b].Name:a._scheduleDays.AllProviders[c].DisplayName)}))});Handlebars.registerHelper("getMoreSlotsLabelString",function(){return new Handlebars.SafeString($$WPUtil.GetStringResource(a._GUID,"moreSlotsLabel_"+(h-1)))});Handlebars.registerHelper("toUpperCase",function(a){return a.toUpperCase()})}};$$WP.Controllers.ScheduleOpeningsController.extend("Controllers.Controller")