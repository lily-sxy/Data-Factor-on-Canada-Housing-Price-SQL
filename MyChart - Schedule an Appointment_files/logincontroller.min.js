$$WPControl.LoginController=function WPControl$LoginController(c,b){var a=this;a.Controllers$Controller(c);if(b._useInlineLogin){a._useInlineLogin=true;a._Initialize(b);return}$$WPUtil.GetUniqueJQueryById(a._GUID,"login").off("click").on("click",$.proxy(a._logIn,a));if(b&&b._signupController)a._signupController=b._signupController};$$WPControl.LoginController.prototype={_GUID:"DFA7477E-2068-4DCA-99B0-794909E5892F_login",_signupController:null,_specialtyId:null,_visitTypeId:null,_locationSearchMethod:null,_locationSearchString:null,_providerId:null,_slotProviderId:null,_departmentId:null,_date:null,_startTime:null,_appointmentTime:null,_arrivalTime:null,_duration:null,_appointmentComments:null,_reservationKey:null,_onDeselectSlotHandler:null,_sessionToken:null,_reservationExpirationTime:null,_useInlineLogin:false,setSelectedSlot:function Epic$PatientAccess$Controllers$LoginController$setSelectedSlot(b,d,f){var e="selected",a=this,g="60F5BCFA-C74D-44B6-BDE7-6BE2CD6A75EE_openScheduling_specialtyStep",c="60F5BCFA-C74D-44B6-BDE7-6BE2CD6A75EE_openScheduling_locationStep";a._specialtyId=$$WPUtil.GetUniqueJQueryById(g,"buttonList").find(".card.selected > a").safeAttr("data-value");if($$WPUtil.GetUniqueJQueryById(c,"geolocation_toggleButton").hasClass(e)){a._locationSearchMethod="GEOLOCATION";a._locationSearchString=null}else if($$WPUtil.GetUniqueJQueryById(c,"search_toggleButton").hasClass(e)){a._locationSearchMethod="SEARCH";a._locationSearchString=$$WPUtil.GetUniqueJQueryById(c,"search_input").val()}else if($$WPUtil.GetUniqueJQueryById(c,"showAll_toggleButton").hasClass(e)){a._locationSearchMethod="SHOW-ALL";a._locationSearchString=null}a._visitTypeId=b.visittypeid;a._providerId=b.providerid;a._slotProviderId=d.SlotProviderId;a._departmentId=b.departmentid;a._date=b.date;a._startTime=b.time;a._appointmentTime=d.AppointmentTime;a._arrivalTime=d.ArrivalTime;a._duration=d.Duration;a._appointmentComments=b.comments;a._reservationKey=b.ReservationKey;a._onDeselectSlotHandler=f;a._sessionToken=b.SessionToken;a._reservationExpirationTime=b.ReservationExpirationTime},_logIn:function Epic$PatientAccess$Controllers$LoginController$_logIn(){this._doLogin(false)},_doLogin:function Epic$PatientAccess$Controllers$LoginController$_doLogin(b){var a=this,c={specialtyId:a._specialtyId,visitTypeId:a._visitTypeId,locationSearchMethod:a._locationSearchMethod,locationSearchString:a._locationSearchString,providerId:a._providerId,slotProviderId:a._slotProviderId,departmentId:a._departmentId,date:a._date,startTime:a._startTime,appointmentTime:a._appointmentTime,arrivalTime:a._arrivalTime,duration:a._duration,appointmentComments:a._appointmentComments,isProviderContext:$$WPUtil.GetStringResource(a._GUID,"IsProviderContext"),parameters:window.location.search.substr(1),useMyChartContext:b?1:0,reservationKey:a._reservationKey,sessionToken:a._sessionToken,reservationExpirationTime:a._reservationExpirationTime};$.ajax({url:makeLink("OpenScheduling/Authentication/LogInRedirect"),type:"POST",data:c,dataType:"json",error:$$WPUtil.DisplayAjaxError,statusCode:{404:function(){}},success:a._redirectToLogin,context:a})},_redirectToLogin:function Epic$PatientAccess$Controllers$LoginController$_redirectToLogin(a){!!this._onDeselectSlotHandler&&WP.Events.removeListener(window,"beforeunload",this._onDeselectSlotHandler);WP.Events.cancelBeforeUnload();window.top.location.href=makeLink(a.Url)},Authenticate:function Epic$PatientAccess$Controllers$LoginController$Authenticate(a){var b=this,c={context:b,callback:a};if(b._useInlineLogin)return b.OldAuthenticate(a);if($$WPUtil.GetUniqueJQueryById(b._GUID,"SupportsLogin").safeAttr("data-val")!=="true"){a&&typeof a==="function"&&a();return}$.ajax({url:makeLink("OpenScheduling/Authentication/TryAuthenticate"),type:"POST",context:c,datatype:"json",success:b._authenticateCallback})},_authenticateCallback:function Epic$PatientAccess$Controllers$LoginController$_authenticateCallback(b){var a=this;if(b&&b.IsAuthenticated)a.context._doLogin(true);else a.callback&&typeof a.callback==="function"&&a.callback()},_IsInitialized:false,_successFunction:null,_errorFunction:null,_isWaitingForResponse:false,_Initialize:function WPControl$LoginController$_Initialize(e){var c=false,f="Login",b="click",d=this,a=d;if(d._IsInitialized===true)return;if(e&&e._successFunction)d._successFunction=e._successFunction;else d._successFunction=d._ShowLoginSuccess;if(e&&e._signupController){d._signupController=e._signupController;$$WPUtil.GetUniqueJQueryById(d._GUID,"submit-login").off(b).on(b,function(b){b.preventDefault();$$WPUtil.GetUniqueJQueryById(a._GUID,f).submit();a._HandleErrors(a);a._signupController.MatchStepHeights();return c});d._errorFunction=function(){a._HandleErrors(a);a._signupController.MatchStepHeights()}}$$WPUtil.GetUniqueJQueryById(d._GUID,f).off("submit").on("submit",function(){var g="landing_content",e=$afe.jq(this),d=$$WPUtil.GetUniqueJQueryById(a._signupController._GUID,"mychart-signup-container"),l=$$WPUtil.GetUniqueJQueryById(a._signupController._GUID,g),h,m,i=$afe.select("body").hasClass("embedded");if(a._isWaitingForResponse)return c;if(!$$WPUtil.ValidateForm(a._GUID,$$WPUtil.GetUniqueJQueryById(a._GUID,f)))return c;a._DisableLoginButton();function ajaxSuccess(v){var j=".selectproxy",f="#next",t=".proxyLinkWrapper",s="loginContainer",r="#backtologin",u=".signupheader,.signupsection,.navigation,.orHolder",n=".proxylistcontainer",e="hidden",q="proxyselect_selected_proxy_index",k="proxyselect_ProxyList",p="noDivider",o="form, div";if(v.action==="showerrors"){$$WPUtil.WriteErrorsToForm(a._GUID,$afe.jq(this),v.errors,v.Mnemonics);if(a._errorFunction&&typeof a._errorFunction==="function")try{a._errorFunction(v.errors)}catch(y){$$WPUtil.ShowUrlInLightbox("Error")}a._EnableLoginButton();return}var w=$$WPUtil.GetUniqueJQueryById(a._GUID,"mychart-proxylist-container");w.children(o).remove();var x=dangerou$.parseHtml(v);WP.Utils.minifyElement(x.find("#proxies"));x.safeAppendTo(w);if(i){w.find(".card").removeClass("card");l.addClass(p)}else w.find(".cardlist").addClass("matchHeights").trigger("cardLoad");$$WPUtil.AjaxifyForm(a._GUID,$$WPUtil.GetUniqueJQueryById(a._GUID,k),a._errorFunction,a._successFunction,$$WPUtil.CallbackTypeEnum.Authenticate);if($$WPUtil.GetUniqueJQueryById(a._GUID,q).val()==="-1"){$$WPUtil.GetUniqueJQueryById(a._GUID,k).submit();return}if(i)h=$$WPUtil.GetUniqueJQueryById(a._signupController._GUID,g).find(".loginContainer, .continueAsGuestContainer");else h=d.find(".loginContainer, .orHolder, .signupheader, .signupsection, .navigation");h.addClass(e);d.find(n).removeClass(e);d.parent().focus();if(i){d.find(u).removeClass(e);$$WPUtil.GetUniqueJQueryById(a._signupController._GUID,"landing_nextstep").off(b,a._clickBackButton).on(b,a._clickBackButton)}$afe.select(r).off(b).on(b,function(){window.clearTimeout(m);a.ResetForm(a);h.removeClass(e);l.removeClass(p);d.find(n).addClass(e).removeClass(s).children(o).remove();d.parent().focus();return c});if($afe.select(t).length===0){d.find(u).removeClass(e);$afe.select(f).addClass(e);d.find(n).addClass(s);d.find(".scheduleorcancel").css("margin-bottom","44px");return}$afe.select(j).off(b).on(b,function(e){var b="disabled",d="selected";e.preventDefault();$$WPUtil.GetUniqueJQueryById(a._GUID,q).val($afe.jq(this).data("proxy-index"));$afe.select(t).removeClass(d);$afe.jq(this).addClass(d).parent().addClass("selectionMade");$afe.select(f).removeClass(b);$afe.select(f).removeAttr(b).prop(b,c);return c});d.find(j).length===1&&d.find(j).get(0).click();$afe.select(j).off("keyup").on("keyup",function(a){a.keyCode&&a.keyCode===13&&$afe.select(f).focus()});$afe.select(f).off(b).on(b,function(){this.disabled=true;$$WPUtil.GetUniqueJQueryById(a._GUID,k).submit();return c});m=window.setTimeout(function(){$afe.select(r).click();a._signupController.ResetForm(a._signupController)},12e4);a._EnableLoginButton();return}var j=e[0].elements.Password.value,k=e[0].elements.LoginId.value;e[0].elements.Password.value=WP.Utils.b64EncodeUnicode(j);e[0].elements.LoginId.value=WP.Utils.b64EncodeUnicode(k);var n=e.serialize();e[0].elements.Password.value=j;e[0].elements.LoginId.value=k;$.ajax({url:e.safeAttr("action"),type:e.safeAttr("method"),data:n,context:e,datatype:"json",error:$$WPUtil.DisplayAjaxError,statusCode:{404:function(){}},success:ajaxSuccess});return c});d._SetupTabbing();d._IsInitialized=true},_SetupTabbing:function WPControl$LoginController$_SetupTabbing(){var a=this,f,e,g,c,b,d;f=$$WPUtil.GetUniqueJQueryById(a._GUID,"LoginId");e=$$WPUtil.GetUniqueJQueryById(a._GUID,"Password");g=$$WPUtil.GetUniqueJQueryById(a._GUID,"submit-login");c=$$WPUtil.GetUniqueJQueryById(a._GUID,"ForgotLoginId");b=$$WPUtil.GetUniqueJQueryById(a._GUID,"ForgotPassword");d=[f,e,g];c&&c.length&&d.push(c);b&&b.length&&d.push(b);$$WPUtil.SetupCustomTabbingForFields(d)},_ShowLoginSuccess:function WPControl$LoginController$_ShowLoginSuccess(a){var b;b=$$WPUtil.GetUniqueJQueryById(this._GUID,"mychart-login-container").find("form");$$WPUtil.GetUniqueJQueryById(this._GUID,"error-for-form-"+b.safeAttr("name")).hide();$$WPUtil.GetUniqueJQueryById(this._GUID,"success-indicator").removeClass("hidden").hide().fadeIn("slow",null,function(){a.action==="lightbox"&&$$WPUtil.ShowUrlInLightbox(a);a.action==="redirect"&&window.location.assign(a.url)});return false},_HandleErrors:function Epic$PatientAccess$Controllers$LoginController$_HandleErrors(a){var b=$$WPUtil.GetUniqueJQueryById(a._GUID,"validation-summary-errors").find(".validation-summary-errors").html();dangerou$.setHtml($$WPUtil.GetUniqueJQueryById(a._GUID,"clear-validation-summary-errors"),b);$$WPUtil.GetUniqueJQueryById(a._GUID,"LoginId").focus()},ResetForm:function Epic$PatientAccess$Controllers$LoginController$ResetForm(b){if(!this._useInlineLogin)return;this._EnableLoginButton();if($$WPUtil.queryString("public")!=="1"){$$WPUtil.GetUniqueJQueryById(b._GUID,"Password").val("");return}var a=$$WPUtil.GetUniqueJQueryById(b._GUID,"Login");a.get(0).reset();a.find("label").each(function(){var b="input-validation-error",d=$afe.jq(this).safeAttr("for"),c=a.find("#"+d);c.length&&c.removeClass(b);$afe.jq(this).removeClass(b)});a.find("span.field-validation-error").each(function(){$afe.jq(this).removeClass("field-validation-error").addClass("field-validation-valid").empty()});a.find("div.validation-summary-errors .validation-summary-errors").each(function(){$afe.jq(this).removeClass("validation-summary-errors").addClass("validation-summary-valid")})},_DisableLoginButton:function Epic$PatientAccess$Controllers$LoginController$_DisableLoginButton(){this._isWaitingForResponse=true;$$WPUtil.GetUniqueJQueryById(this._GUID,"submit-login").addClass("disabled")},_EnableLoginButton:function Epic$PatientAccess$Controllers$LoginController$_EnableLoginButton(){this._isWaitingForResponse=false;$$WPUtil.GetUniqueJQueryById(this._GUID,"submit-login").removeClass("disabled")},OldAuthenticate:function Epic$PatientAccess$Controllers$LoginController$OldAuthenticate(c){var d="function",f="landing_content",a=this,h=$$WPUtil.GetUniqueJQueryById(this._GUID,"Login"),b=$$WPUtil.GetUniqueJQueryById(a._signupController._GUID,"mychart-signup-container"),i=$$WPUtil.GetUniqueJQueryById(a._signupController._GUID,f),e,j,g=$afe.select("body").hasClass("embedded");if($$WPUtil.GetUniqueJQueryById(this._GUID,"SupportsLogin").safeAttr("data-val")!=="true"){c&&typeof c===d&&c();return}function ajaxSuccess(x){var n=".selectproxy",l="#next",u=".proxyLinkWrapper",m=false,t="loginContainer",s="#backtologin",k="click",w=".signupheader,.signupsection,.navigation,.orHolder",o=".proxylistcontainer",h="hidden",r="proxyselect_ProxyList",q="noDivider",p="form, div";if(x.action==="showerrors"||x.action==="none"){c&&typeof c===d&&c();return}var v=$$WPUtil.GetUniqueJQueryById(a._GUID,"mychart-proxylist-container");v.children(p).remove();var z=dangerou$.parseHtml(x);WP.Utils.minifyElement(z.find("#proxies"));z.safeAppendTo(v);if(g){v.find(".card").removeClass("card");i.addClass(q)}else v.find(".cardlist").addClass("matchHeights").trigger("cardLoad");$$WPUtil.AjaxifyForm(a._GUID,$$WPUtil.GetUniqueJQueryById(a._GUID,r),a._errorFunction,a._successFunction,$$WPUtil.CallbackTypeEnum.Authenticate);if(g)e=$$WPUtil.GetUniqueJQueryById(a._signupController._GUID,f).find(".loginContainer, .continueAsGuestContainer");else e=b.find(".loginContainer, .orHolder, .signupheader, .signupsection, .navigation");e.addClass(h);b.find(o).removeClass(h);b.parent().focus();if(g){b.find(w).removeClass(h);$$WPUtil.GetUniqueJQueryById(a._signupController._GUID,"landing_nextstep").off(k,a._clickBackButton).on(k,a._clickBackButton)}$afe.select(s).off(k).on(k,function(){window.clearTimeout(j);a.ResetForm(a);e.removeClass(h);i.removeClass(q);b.find(o).addClass(h).removeClass(t).children(p).remove();b.parent().focus();return m});if($afe.select(u).length===0){b.find(w).removeClass(h);$afe.select(l).addClass(h);b.find(o).addClass(t);b.find(".scheduleorcancel").css("margin-bottom","44px");c&&typeof c===d&&c();return}$afe.select(n).off(k).on(k,function(d){var b="disabled",c="selected";d.preventDefault();$$WPUtil.GetUniqueJQueryById(a._GUID,"proxyselect_selected_proxy_index").val($afe.jq(this).data("proxy-index"));$afe.select(u).removeClass(c);$afe.jq(this).addClass(c).parent().addClass("selectionMade");$afe.select(l).removeClass(b);$afe.select(l).removeAttr(b).prop(b,m);return m});var y=$$WPUtil.GetUniqueJQueryById(a._GUID,"proxyselect_pre-selected_proxy_index");if(b.find(n).length===1)b.find(n).get(0).click();else y.length&&b.find('.selectproxy[data-proxy-index="'+y.html()+'"]').get(0).click();$afe.select(n).off("keyup").on("keyup",function(a){a.keyCode&&a.keyCode===13&&$afe.select(l).focus()});$afe.select(l).off(k).on(k,function(){this.disabled=true;$$WPUtil.GetUniqueJQueryById(a._GUID,r).submit();return m});j=window.setTimeout(function(){$afe.select(s).click();a._signupController.ResetForm(a._signupController)},12e4);c&&typeof c===d&&c();return}$.ajax({url:h.safeAttr("action"),type:h.safeAttr("method"),data:{LoginId:WP.Utils.b64EncodeUnicode("*"),Password:WP.Utils.b64EncodeUnicode("*"),UseMyChartContext:true},context:h,datatype:"json",success:ajaxSuccess})},_clickBackButton:function Epic$PatientAccess$Controllers$LoginController$_clickBackButton(){$afe.select("#backtologin").click()}};$$WPControl.LoginController.extend("Controllers.Controller")