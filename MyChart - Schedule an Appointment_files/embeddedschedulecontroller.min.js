Epic.PatientAccess.Controllers.EmbeddedScheduleController=function Epic$PatientAccess$Controllers$EmbeddedScheduleController(f){var e="keyboard",d=".stepContainer",b=true,c="hidden",a=this;a.Controllers$Controller(f);a._detailsContainer=$$WPUtil.GetUniqueJQueryById(a._GUID,"detailsContainer");a._setOfStepsContainer=$$WPUtil.GetUniqueJQueryById(a._GUID,"setOfStepsContainer");a._slider=$$WPUtil.GetUniqueJQueryById(a._GUID,"slider");a._providerId=$$WPUtil.GetStringResource(a._GUID,"providerId");a._visitTypeId=$$WPUtil.GetStringResource(a._GUID,"visitTypeId");a._departmentId=$$WPUtil.GetStringResource(a._GUID,"departmentId");a._useLoginSession=$$WPUtil.queryString("useloginsession");a._mq="(max-width: "+a._breakpointWidth+"px)";a.canWriteCookies=$$WPUtil.canWriteCookies();if(!a.canWriteCookies){a._detailsContainer.hide().addClass(c);a._setOfStepsContainer.hide().addClass(c);if(self===top)$afe.select("#noCookiesError").removeClass(c).show();else $afe.select("#noCookies").removeClass(c).show();return}if(window.matchMedia)a._RWDbreakpoint_mobile=window.matchMedia(a._mq);$$WPUtil.GetUniqueJQueryById(a._GUID,"progressbar").find(".stepLink").click($.proxy(function(c){var a;a=$afe.jq(c.target);a.is(".enabled")&&this.GoToStep(a.closest("[data-index]").safeAttr("data-index"),b);c.preventDefault()},a));a._setOfStepsContainer.on("click touchend",".button.prevMainStep",$.proxy(function(b){var a=$afe.select(d).index(this.GetCurrentDisplayed());this.GoToStep(a-1);b.preventDefault()},a));if(window.matchMedia){a._RWDbreakpoint_mobile.addListener($.proxy(a.RWDBreakpointCrossed,a));a.RWDBreakpointCrossed(a._RWDbreakpoint_mobile)}else $$WPUtil.AddThrottledListener(window,"resize","",100,function(){var a={};a.media=this._mq;a.matches=window.innerWidth<=this._breakpointWidth;this.RWDBreakpointCrossed(a)}.bind(a));window.addEventListener("message",a.ReceiveMessageFromParent.bind(a));window.addEventListener("keydown",function(){document.body.classList.add(e)},b);window.addEventListener("mousedown",function(){document.body.classList.remove(e)},b);document.addEventListener("focus",$.proxy(a.HandleFocusUnderNavigation,a),b);$$WPUtil.preventAndroidLongPress(a._setOfStepsContainer);if(navigator.userAgent.match(/Trident\/7./))a._setOfStepsContainer.on("mousewheel",".stepContainer.scrollable",function(a){a.stopPropagation()});a._isPostLogin=$$WPUtil.GetStringResource(a._GUID,"isPostLogin")==="1";a._isPostLogin&&window.addEventListener("resize",$.proxy(function(){$afe.jq(this._slider).css("left",-this.GetDivXPosition($afe.select(d).index(this.GetCurrentDisplayed())))},a))};Epic.PatientAccess.Controllers.EmbeddedScheduleController.prototype={_GUID:"0946B3AC-7639-4F83-94A9-25C30DD9C902_EmbeddedSchedule",_breakpointWidth:699,_mq:null,_detailsContainer:null,_setOfStepsContainer:null,_slider:null,_providerId:null,_visitTypeId:null,_departmentId:null,_useLoginSession:null,_RWDbreakpoint_mobile:null,_farthestStep:null,_openingsController:null,_loginSignupController:null,_OSHost:null,_preselectedSlot:null,_preselectedSlotDetails:null,_isPostLogin:false,canWriteCookies:false,PreselectSlot:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$PreselectSlot(){var a=this,d,b,c,f,e,g,n,i,l="",k="",h="",m="",j=null;d=$$WPUtil.GetStringResource(a._GUID,"preselectedProviderId");h=$$WPUtil.GetStringResource(a._GUID,"preselectedSlotProviderId");b=$$WPUtil.GetStringResource(a._GUID,"preselectedDepartmentId");c=$$WPUtil.GetStringResource(a._GUID,"visitTypeId");f=$$WPUtil.GetStringResource(a._GUID,"preselectedDate");e=$$WPUtil.GetStringResource(a._GUID,"preselectedStartTime");g=$$WPUtil.GetStringResource(a._GUID,"preselectedAppointmentTime");n=$$WPUtil.GetStringResource(a._GUID,"preselectedArrivalTime");i=$$WPUtil.GetStringResource(a._GUID,"preselectedDuration");l=$$WPUtil.GetStringResource(a._GUID,"preselectedReservationKey");m=$$WPUtil.GetStringResource(a._GUID,"preselectedSessionToken");k=$$WPUtil.GetStringResource(a._GUID,"preselectedReservationExpirationTime");$$WPUtil.GetStringResource(a._GUID,"warnOnExit")==="1"&&WP.Events.beforeUnload();!$$WPUtil.IsNullOrEmpty(d)&&!$$WPUtil.IsNullOrEmpty(b)&&!$$WPUtil.IsNullOrEmpty(c)&&!$$WPUtil.IsNullOrEmpty(f)&&!$$WPUtil.IsNullOrEmpty(e)&&!$$WPUtil.IsNullOrEmpty(g)&&!$$WPUtil.IsNullOrEmpty(i)&&$.ajax({url:makeLink("OpenScheduling/SignupAndSchedule/GetSlotDetails"),type:"GET",data:{providerId:d,slotProviderId:h,departmentId:b,visitTypeId:c,date:f,startTime:e,appointmentTime:g,arrivalTime:n,duration:i},success:function(g){var a=this;a._preselectedSlot={providerid:d,slotProviderId:h,departmentid:b,visittypeid:c,date:f,time:e,ReservationKey:l,SessionToken:m,reservationExpirationTime:k};a._preselectedSlotDetails=g;j=function(){this._preselectedSlot=null;this._preselectedSlotDetails=null}.bind(a);a._openingsController.ShowPreselectedSlotDetails(a._preselectedSlot,a._preselectedSlotDetails,j)},context:a})},ShowDetailsCallback:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$ShowDetailsCallback(){var a=this;a.DisableProgressBar();$$WPUtil.GetUniqueJQueryById(a._openingsController._GUID,"slotDetails").show();$$WPSchedulingUtil.SetUpInstructions();!a._preselectedSlot&&a.GoToStep(1,true)},HideDetailsCallback:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$HideDetailsCallback(a){$$WPUtil.GetUniqueJQueryById(this._openingsController._GUID,"slotDetails").hide(0,a)},ScheduleSuccessCallback:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$ScheduleSuccessCallback(a){var e="redirect",c=this;if(a.action===e&&!$$WPUtil.IsNullOrEmpty(a.urlForPartial))$.get(a.urlForPartial,$.proxy(function(f){var d,b,c,a,e;d=dangerou$.parseHtml(f);a=$$WPUtil.GetUniqueJQueryById(this._GUID,"confirmContainer");d.filter("*:not(.ajaxspinner)").safeAppendTo(a);this.ScrollToDivByIndex(3,true);this.DisableProgressBar();b=a.find(".popupearlyarrivalreason");if(b){c=a.find(".popupicontext").text();e=$$WP.UI.InfoBubble.SimpleInfoBubble(c);b.empty().safeAppend($afe.renderTemplate($$WP.Templates.UI.InfoBubble,e))}$$WPSchedulingUtil.SetUpInstructions()},this));else if(a.action===e)if((!a.method||a.method.toUpperCase()==="GET")&&$.isEmptyObject(a.parameters))window.top.location=a.url||"/";else{var d,b='<form action="'+a.url+'" method="'+(a.method||"GET")+'" target="_top">';for(d in a.parameters)b=b+'<input type="hidden" name="'+d+'" value="'+a.parameters[d]+'" />';b=b+"</form>";var f=dangerou$.parseHtml(b);$afe.select("body").safeAppend(f);f.submit()}else a.action==="lightbox"&&$$WPUtil.ShowUrlInLightbox(a.url,null,function(){c._loginSignupController.LoginController._clickBackButton();$$WPUtil.GetUniqueJQueryById("9F690F61-B327-458C-A8C2-D7EC4BFCDDDB_error","errorAck").click(function(){$afe.select(".completeworkflow").prop("disabled",false);$$WPUtil.HideLightbox();c.GoToStep(0,true)})},c.__focusErrorPopupHeader,function(){c.GoToStep(0,true)})},__focusErrorPopupHeader:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$__focusErrorPopupHeader(){$afe.select(".errorpopup .error-title").focus()},RWDBreakpointCrossed:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$RWDBreakpointCrossed(a){var b=".offscreen";if(a.matches){this.NotifyParent({layoutChange:"toMobile",media:a.media});$afe.select("body.embedded [id*='loginIntro'].hidden").removeClass("hidden")}else{this.NotifyParent({layoutChange:"toDesktop",media:a.media});this._slider.css("left",-$afe.select(".stepContainer").not(b).get(0).offsetLeft+10);$afe.select(".signupStepsContainer > .slider").css("left",-$afe.select(".signupStep").not(b).get(0).offsetLeft+10);$afe.select("body.embedded [id*='loginIntro']").addClass("hidden")}},NotifyParent:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$NotifyParent(a){var b=this._OSHost||"*";if(self!==top)try{parent.postMessage(a,b)}catch(d){for(var c in a)parent.postMessage(c+": "+a[c],b)}},ReceiveMessageFromParent:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$ReceiveMessageFromParent(b){var d="poppedOut",c;if(this._OSHost&&b.origin.indexOf(this._OSHost)<0)return;var a;if(typeof b.data==="string"){c=b.data.split(": ");a={};a[c[0]]=c[1]}else a=b.data;if(a.maximized)$afe.select("html").addClass(d);else if(a.minimized)$afe.select("html").removeClass(d);else if(a.hostname)this._OSHost=a.hostname},GetCurrentDisplayed:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$GetCurrentDisplayed(){return $afe.select(".stepContainer:not(.offscreen)")},SendPropsToParent:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$SendPropsToParent(){if(self!==top){var b=this,e=b.GetCurrentDisplayed().outerHeight(),a,d,c;function checkHeightTimer(){a=b.GetCurrentDisplayed().outerHeight();if(e!==a){e=a;b.NotifyParent({newHeight:a});if(!$$WPUtil.IsNullOrEmpty(document.activeElement.tagName))if(document.activeElement.tagName.toLowerCase()!=="input"&&document.activeElement.tagName.toLowerCase()!=="textarea"&&document.activeElement.tagName.toLowerCase()!=="select"){d=0,c=$afe.select(".input-validation-error").first();if(c.length>0)d=c.get(0).offsetTop-60;b.NotifyParent({scrollTo:d})}}}setInterval(checkHeightTimer,500)}},GoToStep:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$GoToStep(b,f,e){var c="nointernalscroll",a=this,d=null;if(a._farthestStep===null||b>a._farthestStep)a._farthestStep=b;a.ScrollToDivByIndex(b,f,e);a.UpdateProgressBar(b);if(b===0||b==="0"){$afe.select("html").removeClass("scroll");if(a._openingsController.__firstDteToShow!==0&&a._openingsController.__firstDteToShow!==undefined)a._openingsController.__isNewDateSelected=true;d=$.proxy(function(){var a=this;a._openingsController.ClearScheduleDays();a._openingsController.ShowNextDays(true);a._slider.removeClass(c);a._openingsController.TriggerScrollCheck()},a);a._openingsController.ExecuteDeselectSlotHandler(d)}else{a._slider.addClass(c);$afe.select("html").addClass("scroll")}},ScrollToDivByIndex:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$ScrollToDivByIndex(b,l,k){var j="visibility",d="aria-hidden",c="offscreen",e=".stepContainer",a=this,m=[$$WPUtil.GetUniqueJQueryById(a._GUID,"embeddedContainer"),$$WPUtil.GetUniqueJQueryById(a._GUID,"detailsContainer"),$$WPUtil.GetUniqueJQueryById(a._GUID,"loginSignupContainer"),$$WPUtil.GetUniqueJQueryById(a._GUID,"confirmContainer")],f=m[parseInt(b,10)],g=$afe.select(e).index(a.GetCurrentDisplayed()),i,h=a;(b===0||b==="0")&&a._loginSignupController.ResetForms(a._loginSignupController);if($afe.select(".stepContainer.offscreen").css("display")!=="none")$afe.select(e).each(function(a){(b>g&&a>g||b<g&&a<g)&&$afe.jq(this).removeClass(c).removeAttr(d)});else{$afe.select(e).not(f.get(0)).addClass(c).safeAttr(d,"true");f.removeClass(c).removeAttr(d);a._setOfStepsContainer.css(j,"hidden")}i=function(){$afe.select(e).not(f.get(0)).addClass(c).safeAttr(d,"true");l&&f.safeAttr("tabindex","-1").focus();$afe.select("html, body, .slider").scrollTop(0);h.NotifyParent({oswStep:b});h.NotifyParent({newHeight:h.GetCurrentDisplayed().outerHeight()});self!==top&&$afe.select("html").toggleClass("poppedOut",f.hasClass("scrollable"));h._setOfStepsContainer.css(j,"");this._isPostLogin&&$$WPUtil.UI.MatchColumnHeights()};if(k){$afe.jq(a._slider).css("left",-a.GetDivXPosition(b));i()}else{$afe.jq(a._slider).animate({left:-a.GetDivXPosition(b)},$.proxy(i,a));a._isPostLogin&&$$WPUtil.UI.MatchColumnHeights()}},GetDivXPosition:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$GetDivXPosition(b){var a;a=$afe.select(".stepContainer").outerWidth(true);return b*a},DisableProgressBar:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$DisableProgressBar(){var a;a=$$WPUtil.GetUniqueJQueryById(this._GUID,"progressbar");a.find(".stepLink").removeClass("enabled");a.find(".pbStep").removeClass("complete current").addClass("disabled");this._farthestStep=null},UpdateProgressBar:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$UpdateProgressBar(b){var a;a=$$WPUtil.GetUniqueJQueryById(this._GUID,"progressbar");a.find(".pbStep").each($.proxy(function(c,d){var a;a=$afe.jq(d);c<=this._farthestStep&&a.addClass("complete").removeClass("current").find(".stepLink").addClass("enabled");if(c===parseInt(b,10)){a.addClass("current");a.children().children().length>0&&a.children().first().children().first().remove();a.children().first().safeAppend(dangerou$.parseHtml($$WPUtil.GetStringResource(this._GUID,"active")))}else{a.children().children().length>0&&a.children().first().children().first().remove();a.children().first().safeAppend(dangerou$.parseHtml($$WPUtil.GetStringResource(this._GUID,"inactive")))}},this))},OnCaptchaShown:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$OnCaptchaShown(){this.NotifyParent({isCaptchaShown:true})},HandleFocusUnderNavigation:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$HandleFocusUnderNavigation(c){var a=c.target,b=null;if(!!a.closest("form")&&!!a.closest(".keyboard")){b=this.__getNavigationContainer();if(b.length>0)this.__isElementObscuredByNavigation(a,b[0])&&a.scrollIntoView()}},__getNavigationContainer:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$__getNavigationContainer(){var b=null,a=null;b=this.GetCurrentDisplayed();a=b.find(".signupStep").not(".offscreen");if(a.length===0)a=b;return a.find(".float")},__isElementObscuredByNavigation:function Epic$PatientAccess$Controllers$EmbeddedScheduleController$__isElementObscuredByNavigation(d,a){var b=0,c=0;b=d.getBoundingClientRect().bottom;c=a.getBoundingClientRect().top;return b>c&&!a.contains(d)}};$$WP.Controllers.EmbeddedScheduleController.extend("Controllers.Controller");$$WP.Utilities.UI.OnUIFrameworkLoaded(function(){var b=true,e,d,a,c;a=new $$WP.Controllers.EmbeddedScheduleController("");d=new $$WP.Controllers.LoginSignupController("",{_useInlineLogin:$$WPUtil.GetStringResource(a._GUID,"useInlineLogin")==="1"});d.ShowAsRegularContent();a._loginSignupController=d;if(!a.canWriteCookies){a.NotifyParent({layoutChange:"buttonOnly"});return}c={_detailsContainer:a._detailsContainer,_showDetailsCallback:$.proxy(a.ShowDetailsCallback,a),_hideDetailsCallback:$.proxy(a.HideDetailsCallback,a),_openingsUrl:$$WPUtil.GetStringResource(a._GUID,"openingsUrl"),_scheduleUrl:$$WPUtil.GetStringResource(a._GUID,"scheduleUrl"),_providerId:a._providerId,_visitTypeId:a._visitTypeId,_departmentId:a._departmentId,_useLoginSession:a._useLoginSession,_LoginSignupController:d,_BreakpointWidth:a._breakpointWidth,_onCaptchaShown:$.proxy(a.OnCaptchaShown,a),_accessCode:$$WPUtil.GetStringResource(a._GUID,"accessCode"),_isDemographicAuthenticationRequired:$$WPUtil.GetStringResource(a._GUID,"isDemographicAuthenticationRequired"),_firstNameFromAccessCode:$$WPUtil.GetStringResource(a._GUID,"firstNameFromAccessCode"),_sourceToken:$$WPUtil.GetStringResource(a._GUID,"sourceToken"),_errorCode:$$WPUtil.GetStringResource(a._GUID,"errorCode"),_appointmentComments:$$WPUtil.GetStringResource(a._GUID,"preselectedAppointmentComments"),_isEmbedded:b};if(a._isPostLogin){c._isPostLogin=b;c._isProviderContext=b;c._useMyChartContext=b;c._showAuthPaneFunction=function(){d.LoginController.Authenticate(function(){a.GoToStep(2,b,!!a._preselectedSlot)})};c._scheduleSuccessLightboxCallback=$.proxy(function(){this.GoToStep(0,b)},a)}else{if(c._useLoginSession==="1")c._showAuthPaneFunction=function(){d.LoginController.Authenticate(function(){a.GoToStep(2,b)})};else c._showAuthPaneFunction=function(){a.GoToStep(2,b)};c._scheduleSuccessFunction=$.proxy(a.ScheduleSuccessCallback,a)}if($$WPUtil.GetStringResource(a._GUID,"forceGuestWorkflow")==="1")c._useMyChartContext=false;e=new $$WP.Controllers.ScheduleOpeningsController("",c);a._openingsController=e;e.ShowNextDays();a.GoToStep(0,false,b);a.SendPropsToParent();a.PreselectSlot();!a._isPostLogin&&$$WPSchedulingUtil.SetPreloginTimeout()})